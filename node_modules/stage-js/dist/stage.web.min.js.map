{"version":3,"sources":["webpack://Stage/webpack/universalModuleDefinition","webpack://Stage/webpack/bootstrap","webpack://Stage/./lib/core.js","webpack://Stage/./lib/util/create.js","webpack://Stage/./lib/pin.js","webpack://Stage/./lib/loop.js","webpack://Stage/./lib/util/stats.js","webpack://Stage/./lib/util/extend.js","webpack://Stage/./lib/util/is.js","webpack://Stage/./lib/texture.js","webpack://Stage/./lib/util/math.js","webpack://Stage/./lib/matrix.js","webpack://Stage/./lib/index.js","webpack://Stage/./lib/util/await.js","webpack://Stage/./lib/atlas.js","webpack://Stage/./lib/util/string.js","webpack://Stage/./lib/tree.js","webpack://Stage/./lib/event.js","webpack://Stage/./lib/util/event.js","webpack://Stage/./lib/root.js","webpack://Stage/./lib/canvas.js","webpack://Stage/./lib/image.js","webpack://Stage/./lib/util/repeat.js","webpack://Stage/./lib/anim.js","webpack://Stage/./lib/str.js","webpack://Stage/./lib/layout.js","webpack://Stage/./lib/addon/tween.js","webpack://Stage/./lib/addon/easing.js","webpack://Stage/./lib/addon/mouse.js","webpack://Stage/./platform/web.js","webpack://Stage/./lib/loader/web.js"],"names":["root","factory","exports","module","define","amd","window","installedModules","__webpack_require__","moduleId","i","l","modules","call","m","c","d","name","getter","o","Object","defineProperty","enumerable","get","r","Symbol","toStringTag","value","t","mode","__esModule","ns","create","key","bind","n","object","property","prototype","hasOwnProperty","p","s","stats","extend","is","_await","Class","arg","this","fn","app","apply","arguments","atlas","_init","length","push","_load","_config","config","string","_app_queue","_stages","_loaded","_paused","opts","loader","stage","canvas","start","loading","preload","load","url","resolve","test","callback","src","el","document","createElement","addEventListener","err","id","Date","now","body","appendChild","loadScript","then","args","shift","pause","resume","scripts","getElementsByTagName","currentScript","stack","Error","split","match","readyState","location","href","getScriptSrc","substring","lastIndexOf","proto","props","noop","Matrix","iid","Pin","owner","_owner","_parent","_relativeMatrix","_absoluteMatrix","reset","_pin","matrix","relative","relativeMatrix","absoluteMatrix","pin","a","b","set","_textureAlpha","_alpha","_width","_height","_scaleX","_scaleY","_skewX","_skewY","_rotation","_pivoted","_pivotX","_pivotY","_handled","_handleX","_handleY","_aligned","_alignX","_alignY","_offsetX","_offsetY","_boxX","_boxY","_boxWidth","_boxHeight","_ts_translate","_ts_transform","_ts_matrix","_update","_mo_handle","_mo_align","toString","ts","Math","max","_mo_abs","abs","concat","_mo_rel","q","rel","identity","translate","scale","skew","rotate","_x","_y","getters","setters","_ts_pin","touch","alpha","textureAlpha","width","height","boxWidth","boxHeight","scaleX","scaleY","skewX","skewY","rotation","pivotX","pivotY","offsetX","offsetY","alignX","alignY","handleX","handleY","_width_","_height_","pivot","offset","align","handle","resizeMode","all","scaleTo","resizeWidth","resizeHeight","scaleMode","scaleWidth","scaleHeight","e","f","w","h","min","y","x","_add_shortcuts","size","ta","_textures","render","context","_visible","node","setTransform","globalAlpha","draw","child","next","_first","_next","_tickBefore","_tickAfter","MAX_ELAPSE","Infinity","_tick","elapsed","last","ticked","tick","_flag","ticker","before","untick","indexOf","splice","timeout","time","setTimeout","timer","clearTimeout","base","obj","objProto","owns","toStr","hexRegex","an","type","defined","empty","equal","other","getTime","instance","constructor","nil","undef","array","emptyarray","arraylike","boolean","isFinite","number","element","undefined","HTMLElement","nodeType","nan","hash","setInterval","regexp","hex","math","Texture","image","ratio","pipe","_image","_sx","_dx","_sy","_dy","_sw","_dw","_sh","_dh","dest","x1","y1","x2","y2","x3","y3","x4","y4","sx","sy","sw","sh","dx","dy","dw","dh","limit","drawImage","ex","_draw_failed","console","log","native","random","num","sqrt","clone","_dirty","angle","u","cos","v","sin","inverse","reverse","inversed","z","map","mapX","mapY","count","fork","_atlases_map","_atlases_arr","Atlas","def","_super","deprecated","filter","ppu","trim","textures","cutouts","sprites","make","top","bottom","left","right","texture","find","query","result","startsWith","subquery","select","Selection","found","imagePath","imageRatio","done","imageloader","nfTexture","nfSelection","link","one","arr","msg","replace","slice","error","str","sub","append","parent","_ensure","remove","_last","_prev","_ts_parent","_ts_children","prepend","insertBefore","self","prev","insertAfter","_label","_attrs","_flags","label","attr","visible","hide","show","first","visit","visitor","data","end","more","appendTo","prependTo","insertNext","sibling","insertPrev","_ts_touch","hitTest","hit","on","_listeners","listen","types","listener","join","off","index","listeners","publish","trigger","Root","request","paused","stopped","lastTime","loop","_mo_touch","fps","touch_root","stop","background","color","viewport","_viewport","viewbox","_viewbox","box","attributes","drawFn","getContext","repeat","Image","img","setImage","tile","inner","_repeat","stretch","insert","_repeatTicker","_mo_stretch","owidth","oheight","Anim","_fps","FPS","_ft","_time","_index","_frames","ignore","moveFrame","_callback","anim","frames","gotoFrame","setFrames","frame","resize","move","play","Str","setFont","_item","setValue","_value","_spacing","row","sequence","column","_padding","_layoutTiker","_mo_seq","alignChildren","_mo_seqAlign","_mo_box","layer","padding","pad","spacing","space","Easing","Tween","duration","delay","_end","_duration","_delay","pinning","tween","_tweens","ticktime","head","Array","isArray","unshift","over","_start","_easing","actions","_hide","_remove","_done","ease","easing","clear","forward","_identity","_cache","_modes","_easings","token","exec","params","fc","add","names","PI","pow","asin","Mouse","elem","locate","event","ev","loc","touches","clientX","clientY","rect","getBoundingClientRect","clientLeft","clientTop","locateElevent","lookup","collect","targets","timeStamp","mouse","raw","cancel","subscribe","CLICK","START","MOVE","END","CANCEL","handleStart","handleEnd","handleMove","handleCancel","clicklist","cancellist","preventDefault","defineValue","internal","_extend","_create","_supported","configs","full","getElementById","style","position","firstChild","devicePixelRatio","backingStoreRatio","webkitBackingStorePixelRatio","mozBackingStorePixelRatio","msBackingStorePixelRatio","oBackingStorePixelRatio","backingStorePixelRatio","requestAnimationFrame","msRequestAnimationFrame","mozRequestAnimationFrame","webkitRequestAnimationFrame","oRequestAnimationFrame","clearRect","backgroundColor","lastWidth","lastHeight","innerWidth","screen","innerHeight","clientWidth","clientHeight","resizeLoop","success","onload","onerror"],"mappings":"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","file":"stage.web.min.js","sourcesContent":["(function webpackUniversalModuleDefinition(root, factory) {\n\tif(typeof exports === 'object' && typeof module === 'object')\n\t\tmodule.exports = factory();\n\telse if(typeof define === 'function' && define.amd)\n\t\tdefine([], factory);\n\telse if(typeof exports === 'object')\n\t\texports[\"Stage\"] = factory();\n\telse\n\t\troot[\"Stage\"] = factory();\n})(window, function() {\nreturn "," \t// The module cache\n \tvar installedModules = {};\n\n \t// The require function\n \tfunction __webpack_require__(moduleId) {\n\n \t\t// Check if module is in cache\n \t\tif(installedModules[moduleId]) {\n \t\t\treturn installedModules[moduleId].exports;\n \t\t}\n \t\t// Create a new module (and put it into the cache)\n \t\tvar module = installedModules[moduleId] = {\n \t\t\ti: moduleId,\n \t\t\tl: false,\n \t\t\texports: {}\n \t\t};\n\n \t\t// Execute the module function\n \t\tmodules[moduleId].call(module.exports, module, module.exports, __webpack_require__);\n\n \t\t// Flag the module as loaded\n \t\tmodule.l = true;\n\n \t\t// Return the exports of the module\n \t\treturn module.exports;\n \t}\n\n\n \t// expose the modules object (__webpack_modules__)\n \t__webpack_require__.m = modules;\n\n \t// expose the module cache\n \t__webpack_require__.c = installedModules;\n\n \t// define getter function for harmony exports\n \t__webpack_require__.d = function(exports, name, getter) {\n \t\tif(!__webpack_require__.o(exports, name)) {\n \t\t\tObject.defineProperty(exports, name, { enumerable: true, get: getter });\n \t\t}\n \t};\n\n \t// define __esModule on exports\n \t__webpack_require__.r = function(exports) {\n \t\tif(typeof Symbol !== 'undefined' && Symbol.toStringTag) {\n \t\t\tObject.defineProperty(exports, Symbol.toStringTag, { value: 'Module' });\n \t\t}\n \t\tObject.defineProperty(exports, '__esModule', { value: true });\n \t};\n\n \t// create a fake namespace object\n \t// mode & 1: value is a module id, require it\n \t// mode & 2: merge all properties of value into the ns\n \t// mode & 4: return value when already ns object\n \t// mode & 8|1: behave like require\n \t__webpack_require__.t = function(value, mode) {\n \t\tif(mode & 1) value = __webpack_require__(value);\n \t\tif(mode & 8) return value;\n \t\tif((mode & 4) && typeof value === 'object' && value && value.__esModule) return value;\n \t\tvar ns = Object.create(null);\n \t\t__webpack_require__.r(ns);\n \t\tObject.defineProperty(ns, 'default', { enumerable: true, value: value });\n \t\tif(mode & 2 && typeof value != 'string') for(var key in value) __webpack_require__.d(ns, key, function(key) { return value[key]; }.bind(null, key));\n \t\treturn ns;\n \t};\n\n \t// getDefaultExport function for compatibility with non-harmony modules\n \t__webpack_require__.n = function(module) {\n \t\tvar getter = module && module.__esModule ?\n \t\t\tfunction getDefault() { return module['default']; } :\n \t\t\tfunction getModuleExports() { return module; };\n \t\t__webpack_require__.d(getter, 'a', getter);\n \t\treturn getter;\n \t};\n\n \t// Object.prototype.hasOwnProperty.call\n \t__webpack_require__.o = function(object, property) { return Object.prototype.hasOwnProperty.call(object, property); };\n\n \t// __webpack_public_path__\n \t__webpack_require__.p = \"\";\n\n\n \t// Load entry module and return exports\n \treturn __webpack_require__(__webpack_require__.s = 27);\n","var STAGE_DEBUG = typeof DEBUG === 'undefined' ? false : !!DEBUG;\n\nvar stats = require('./util/stats');\nvar extend = require('./util/extend');\nvar is = require('./util/is');\nvar _await = require('./util/await');\n\nstats.create = 0;\n\nfunction Class(arg) {\n  if (!(this instanceof Class)) {\n    if (is.fn(arg)) {\n      return Class.app.apply(Class, arguments);\n    } else if (is.object(arg)) {\n      return Class.atlas.apply(Class, arguments);\n    } else {\n      return arg;\n    }\n  }\n\n  stats.create++;\n\n  for (var i = 0; i < _init.length; i++) {\n    _init[i].call(this);\n  }\n}\n\nvar _init = [];\n\nClass._init = function(fn) {\n  _init.push(fn);\n};\n\nvar _load = [];\n\nClass._load = function(fn) {\n  _load.push(fn);\n};\n\nvar _config = {};\n\nClass.config = function() {\n  if (arguments.length === 1 && is.string(arguments[0])) {\n    return _config[arguments[0]];\n  }\n  if (arguments.length === 1 && is.object(arguments[0])) {\n    extend(_config, arguments[0]);\n  }\n  if (arguments.length === 2 && is.string(arguments[0])) {\n    _config[arguments[0], arguments[1]];\n  }\n};\n\nvar _app_queue = [];\nvar _preload_queue = [];\nvar _stages = [];\nvar _loaded = false;\nvar _paused = false;\n\nClass.app = function(app, opts) {\n  if (!_loaded) {\n    _app_queue.push(arguments);\n    return;\n  }\n  STAGE_DEBUG && console.log('Creating app...');\n  var loader = Class.config('app-loader');\n  loader(function(stage, canvas) {\n    STAGE_DEBUG && console.log('Initing app...');\n    for (var i = 0; i < _load.length; i++) {\n      _load[i].call(this, stage, canvas);\n    }\n    app(stage, canvas);\n    _stages.push(stage);\n    STAGE_DEBUG && console.log('Starting app...');\n    stage.start();\n  }, opts);\n};\n\nvar loading = _await();\n\nClass.preload = function(load) {\n  if (typeof load === 'string') {\n    var url = Class.resolve(load);\n    if (/\\.js($|\\?|\\#)/.test(url)) {\n      STAGE_DEBUG && console.log('Loading script: ' + url);\n      load = function(callback) {\n        loadScript(url, callback);\n      };\n    }\n  }\n  if (typeof load !== 'function') {\n    return;\n  }\n  // if (!_started) {\n  // _preload_queue.push(load);\n  // return;\n  // }\n  load(loading());\n};\n\nClass.start = function(config) {\n  STAGE_DEBUG && console.log('Starting...');\n\n  Class.config(config);\n\n  // STAGE_DEBUG && console.log('Preloading...');\n  // _started = true;\n  // while (_preload_queue.length) {\n  // var load = _preload_queue.shift();\n  // load(loading());\n  // }\n\n  loading.then(function() {\n    STAGE_DEBUG && console.log('Loading apps...');\n    _loaded = true;\n    while (_app_queue.length) {\n      var args = _app_queue.shift();\n      Class.app.apply(Class, args);\n    }\n  });\n};\n\nClass.pause = function() {\n  if (!_paused) {\n    _paused = true;\n    for (var i = _stages.length - 1; i >= 0; i--) {\n      _stages[i].pause();\n    }\n  }\n};\n\nClass.resume = function() {\n  if (_paused) {\n    _paused = false;\n    for (var i = _stages.length - 1; i >= 0; i--) {\n      _stages[i].resume();\n    }\n  }\n};\n\nClass.create = function() {\n  return new Class();\n};\n\nClass.resolve = (function() {\n\n  if (typeof window === 'undefined' || typeof document === 'undefined') {\n    return function(url) {\n      return url;\n    };\n  }\n\n  var scripts = document.getElementsByTagName('script');\n\n  function getScriptSrc() {\n    // HTML5\n    if (document.currentScript) {\n      return document.currentScript.src;\n    }\n\n    // IE>=10\n    var stack;\n    try {\n      var err = new Error();\n      if (err.stack) {\n        stack = err.stack;\n      } else {\n        throw err;\n      }\n    } catch (err) {\n      stack = err.stack;\n    }\n    if (typeof stack === 'string') {\n      stack = stack.split('\\n');\n      // Uses the last line, where the call started\n      for (var i = stack.length; i--;) {\n        var url = stack[i].match(/(\\w+\\:\\/\\/[^/]*?\\/.+?)(:\\d+)(:\\d+)?/);\n        if (url) {\n          return url[1];\n        }\n      }\n    }\n\n    // IE<11\n    if (scripts.length && 'readyState' in scripts[0]) {\n      for (var i = scripts.length; i--;) {\n        if (scripts[i].readyState === 'interactive') {\n          return scripts[i].src;\n        }\n      }\n    }\n\n    return location.href;\n  }\n\n  return function(url) {\n    if (/^\\.\\//.test(url)) {\n      var src = getScriptSrc();\n      var base = src.substring(0, src.lastIndexOf('/') + 1);\n      url = base + url.substring(2);\n      // } else if (/^\\.\\.\\//.test(url)) {\n      // url = base + url;\n    }\n    return url;\n  };\n})();\n\nmodule.exports = Class;\n\nfunction loadScript(src, callback) {\n  var el = document.createElement('script');\n  el.addEventListener('load', function() {\n    callback();\n  });\n  el.addEventListener('error', function(err) {\n    callback(err || 'Error loading script: ' + src);\n  });\n  el.src = src;\n  el.id = 'preload-' + Date.now();\n  document.body.appendChild(el);\n};","if (typeof Object.create == 'function') {\n  module.exports = function(proto, props) {\n    return Object.create.call(Object, proto, props);\n  };\n} else {\n  module.exports = function(proto, props) {\n    if (props)\n      throw Error('Second argument is not supported!');\n    if (typeof proto !== 'object' || proto === null)\n      throw Error('Invalid prototype!');\n    noop.prototype = proto;\n    return new noop;\n  };\n  function noop() {\n  }\n}\n","var Class = require('./core');\nvar Matrix = require('./matrix');\n\nvar iid = 0;\n\nClass._init(function() {\n  this._pin = new Pin(this);\n});\n\nClass.prototype.matrix = function(relative) {\n  if (relative === true) {\n    return this._pin.relativeMatrix();\n  }\n  return this._pin.absoluteMatrix();\n};\n\nClass.prototype.pin = function(a, b) {\n  if (typeof a === 'object') {\n    this._pin.set(a);\n    return this;\n\n  } else if (typeof a === 'string') {\n    if (typeof b === 'undefined') {\n      return this._pin.get(a);\n    } else {\n      this._pin.set(a, b);\n      return this;\n    }\n  } else if (typeof a === 'undefined') {\n    return this._pin;\n  }\n};\n\nfunction Pin(owner) {\n\n  this._owner = owner;\n  this._parent = null;\n\n  // relative to parent\n  this._relativeMatrix = new Matrix();\n\n  // relative to stage\n  this._absoluteMatrix = new Matrix();\n\n  this.reset();\n};\n\nPin.prototype.reset = function() {\n\n  this._textureAlpha = 1;\n  this._alpha = 1;\n\n  this._width = 0;\n  this._height = 0;\n\n  this._scaleX = 1;\n  this._scaleY = 1;\n  this._skewX = 0;\n  this._skewY = 0;\n  this._rotation = 0;\n\n  // scale/skew/rotate center\n  this._pivoted = false;\n  this._pivotX = null;\n  this._pivotY = null;\n\n  // self pin point\n  this._handled = false;\n  this._handleX = 0;\n  this._handleY = 0;\n\n  // parent pin point\n  this._aligned = false;\n  this._alignX = 0;\n  this._alignY = 0;\n\n  // as seen by parent px\n  this._offsetX = 0;\n  this._offsetY = 0;\n\n  this._boxX = 0;\n  this._boxY = 0;\n  this._boxWidth = this._width;\n  this._boxHeight = this._height;\n\n  // TODO: also set for owner\n  this._ts_translate = ++iid;\n  this._ts_transform = ++iid;\n  this._ts_matrix = ++iid;\n};\n\nPin.prototype._update = function() {\n  this._parent = this._owner._parent && this._owner._parent._pin;\n\n  // if handled and transformed then be translated\n  if (this._handled && this._mo_handle != this._ts_transform) {\n    this._mo_handle = this._ts_transform;\n    this._ts_translate = ++iid;\n  }\n\n  if (this._aligned && this._parent\n      && this._mo_align != this._parent._ts_transform) {\n    this._mo_align = this._parent._ts_transform;\n    this._ts_translate = ++iid;\n  }\n\n  return this;\n};\n\nPin.prototype.toString = function() {\n  return this._owner + ' (' + (this._parent ? this._parent._owner : null) + ')';\n};\n\n// TODO: ts fields require refactoring\n\nPin.prototype.absoluteMatrix = function() {\n  this._update();\n  var ts = Math.max(\n    this._ts_transform,\n    this._ts_translate,\n    this._parent ? this._parent._ts_matrix : 0\n  );\n  if (this._mo_abs == ts) {\n    return this._absoluteMatrix;\n  }\n  this._mo_abs = ts;\n\n  var abs = this._absoluteMatrix;\n  abs.reset(this.relativeMatrix());\n\n  this._parent && abs.concat(this._parent._absoluteMatrix);\n\n  this._ts_matrix = ++iid;\n\n  return abs;\n};\n\nPin.prototype.relativeMatrix = function() {\n  this._update();\n  var ts = Math.max(this._ts_transform, this._ts_translate,\n      this._parent ? this._parent._ts_transform : 0);\n  if (this._mo_rel == ts) {\n    return this._relativeMatrix;\n  }\n  this._mo_rel = ts;\n\n  var rel = this._relativeMatrix;\n\n  rel.identity();\n  if (this._pivoted) {\n    rel.translate(-this._pivotX * this._width, -this._pivotY * this._height);\n  }\n  rel.scale(this._scaleX, this._scaleY);\n  rel.skew(this._skewX, this._skewY);\n  rel.rotate(this._rotation);\n  if (this._pivoted) {\n    rel.translate(this._pivotX * this._width, this._pivotY * this._height);\n  }\n\n  // calculate effective box\n  if (this._pivoted) {\n    // origin\n    this._boxX = 0;\n    this._boxY = 0;\n    this._boxWidth = this._width;\n    this._boxHeight = this._height;\n\n  } else {\n    // aabb\n    var p, q;\n    if (rel.a > 0 && rel.c > 0 || rel.a < 0 && rel.c < 0) {\n      p = 0, q = rel.a * this._width + rel.c * this._height;\n    } else {\n      p = rel.a * this._width, q = rel.c * this._height;\n    }\n    if (p > q) {\n      this._boxX = q;\n      this._boxWidth = p - q;\n    } else {\n      this._boxX = p;\n      this._boxWidth = q - p;\n    }\n    if (rel.b > 0 && rel.d > 0 || rel.b < 0 && rel.d < 0) {\n      p = 0, q = rel.b * this._width + rel.d * this._height;\n    } else {\n      p = rel.b * this._width, q = rel.d * this._height;\n    }\n    if (p > q) {\n      this._boxY = q;\n      this._boxHeight = p - q;\n    } else {\n      this._boxY = p;\n      this._boxHeight = q - p;\n    }\n  }\n\n  this._x = this._offsetX;\n  this._y = this._offsetY;\n\n  this._x -= this._boxX + this._handleX * this._boxWidth;\n  this._y -= this._boxY + this._handleY * this._boxHeight;\n\n  if (this._aligned && this._parent) {\n    this._parent.relativeMatrix();\n    this._x += this._alignX * this._parent._width;\n    this._y += this._alignY * this._parent._height;\n  }\n\n  rel.translate(this._x, this._y);\n\n  return this._relativeMatrix;\n};\n\nPin.prototype.get = function(key) {\n  if (typeof getters[key] === 'function') {\n    return getters[key](this);\n  }\n};\n\n// TODO: Use defineProperty instead? What about multi-field pinning?\nPin.prototype.set = function(a, b) {\n  if (typeof a === 'string') {\n    if (typeof setters[a] === 'function' && typeof b !== 'undefined') {\n      setters[a](this, b);\n    }\n  } else if (typeof a === 'object') {\n    for (b in a) {\n      if (typeof setters[b] === 'function' && typeof a[b] !== 'undefined') {\n        setters[b](this, a[b], a);\n      }\n    }\n  }\n  if (this._owner) {\n    this._owner._ts_pin = ++iid;\n    this._owner.touch();\n  }\n  return this;\n};\n\nvar getters = {\n  alpha : function(pin) {\n    return pin._alpha;\n  },\n\n  textureAlpha : function(pin) {\n    return pin._textureAlpha;\n  },\n\n  width : function(pin) {\n    return pin._width;\n  },\n\n  height : function(pin) {\n    return pin._height;\n  },\n\n  boxWidth : function(pin) {\n    return pin._boxWidth;\n  },\n\n  boxHeight : function(pin) {\n    return pin._boxHeight;\n  },\n\n  // scale : function(pin) {\n  // },\n\n  scaleX : function(pin) {\n    return pin._scaleX;\n  },\n\n  scaleY : function(pin) {\n    return pin._scaleY;\n  },\n\n  // skew : function(pin) {\n  // },\n\n  skewX : function(pin) {\n    return pin._skewX;\n  },\n\n  skewY : function(pin) {\n    return pin._skewY;\n  },\n\n  rotation : function(pin) {\n    return pin._rotation;\n  },\n\n  // pivot : function(pin) {\n  // },\n\n  pivotX : function(pin) {\n    return pin._pivotX;\n  },\n\n  pivotY : function(pin) {\n    return pin._pivotY;\n  },\n\n  // offset : function(pin) {\n  // },\n\n  offsetX : function(pin) {\n    return pin._offsetX;\n  },\n\n  offsetY : function(pin) {\n    return pin._offsetY;\n  },\n\n  // align : function(pin) {\n  // },\n\n  alignX : function(pin) {\n    return pin._alignX;\n  },\n\n  alignY : function(pin) {\n    return pin._alignY;\n  },\n\n  // handle : function(pin) {\n  // },\n\n  handleX : function(pin) {\n    return pin._handleX;\n  },\n\n  handleY : function(pin) {\n    return pin._handleY;\n  }\n};\n\nvar setters = {\n  alpha : function(pin, value) {\n    pin._alpha = value;\n  },\n\n  textureAlpha : function(pin, value) {\n    pin._textureAlpha = value;\n  },\n\n  width : function(pin, value) {\n    pin._width_ = value;\n    pin._width = value;\n    pin._ts_transform = ++iid;\n  },\n\n  height : function(pin, value) {\n    pin._height_ = value;\n    pin._height = value;\n    pin._ts_transform = ++iid;\n  },\n\n  scale : function(pin, value) {\n    pin._scaleX = value;\n    pin._scaleY = value;\n    pin._ts_transform = ++iid;\n  },\n\n  scaleX : function(pin, value) {\n    pin._scaleX = value;\n    pin._ts_transform = ++iid;\n  },\n\n  scaleY : function(pin, value) {\n    pin._scaleY = value;\n    pin._ts_transform = ++iid;\n  },\n\n  skew : function(pin, value) {\n    pin._skewX = value;\n    pin._skewY = value;\n    pin._ts_transform = ++iid;\n  },\n\n  skewX : function(pin, value) {\n    pin._skewX = value;\n    pin._ts_transform = ++iid;\n  },\n\n  skewY : function(pin, value) {\n    pin._skewY = value;\n    pin._ts_transform = ++iid;\n  },\n\n  rotation : function(pin, value) {\n    pin._rotation = value;\n    pin._ts_transform = ++iid;\n  },\n\n  pivot : function(pin, value) {\n    pin._pivotX = value;\n    pin._pivotY = value;\n    pin._pivoted = true;\n    pin._ts_transform = ++iid;\n  },\n\n  pivotX : function(pin, value) {\n    pin._pivotX = value;\n    pin._pivoted = true;\n    pin._ts_transform = ++iid;\n  },\n\n  pivotY : function(pin, value) {\n    pin._pivotY = value;\n    pin._pivoted = true;\n    pin._ts_transform = ++iid;\n  },\n\n  offset : function(pin, value) {\n    pin._offsetX = value;\n    pin._offsetY = value;\n    pin._ts_translate = ++iid;\n  },\n\n  offsetX : function(pin, value) {\n    pin._offsetX = value;\n    pin._ts_translate = ++iid;\n  },\n\n  offsetY : function(pin, value) {\n    pin._offsetY = value;\n    pin._ts_translate = ++iid;\n  },\n\n  align : function(pin, value) {\n    this.alignX(pin, value);\n    this.alignY(pin, value);\n  },\n\n  alignX : function(pin, value) {\n    pin._alignX = value;\n    pin._aligned = true;\n    pin._ts_translate = ++iid;\n\n    this.handleX(pin, value);\n  },\n\n  alignY : function(pin, value) {\n    pin._alignY = value;\n    pin._aligned = true;\n    pin._ts_translate = ++iid;\n\n    this.handleY(pin, value);\n  },\n\n  handle : function(pin, value) {\n    this.handleX(pin, value);\n    this.handleY(pin, value);\n  },\n\n  handleX : function(pin, value) {\n    pin._handleX = value;\n    pin._handled = true;\n    pin._ts_translate = ++iid;\n  },\n\n  handleY : function(pin, value) {\n    pin._handleY = value;\n    pin._handled = true;\n    pin._ts_translate = ++iid;\n  },\n\n  resizeMode : function(pin, value, all) {\n    if (all) {\n      if (value == 'in') {\n        value = 'in-pad';\n      } else if (value == 'out') {\n        value = 'out-crop';\n      }\n      scaleTo(pin, all.resizeWidth, all.resizeHeight, value);\n    }\n  },\n\n  resizeWidth : function(pin, value, all) {\n    if (!all || !all.resizeMode) {\n      scaleTo(pin, value, null);\n    }\n  },\n\n  resizeHeight : function(pin, value, all) {\n    if (!all || !all.resizeMode) {\n      scaleTo(pin, null, value);\n    }\n  },\n\n  scaleMode : function(pin, value, all) {\n    if (all) {\n      scaleTo(pin, all.scaleWidth, all.scaleHeight, value);\n    }\n  },\n\n  scaleWidth : function(pin, value, all) {\n    if (!all || !all.scaleMode) {\n      scaleTo(pin, value, null);\n    }\n  },\n\n  scaleHeight : function(pin, value, all) {\n    if (!all || !all.scaleMode) {\n      scaleTo(pin, null, value);\n    }\n  },\n\n  matrix : function(pin, value) {\n    this.scaleX(pin, value.a);\n    this.skewX(pin, value.c / value.d);\n    this.skewY(pin, value.b / value.a);\n    this.scaleY(pin, value.d);\n    this.offsetX(pin, value.e);\n    this.offsetY(pin, value.f);\n    this.rotation(pin, 0);\n  }\n};\n\nfunction scaleTo(pin, width, height, mode) {\n  var w = typeof width === 'number';\n  var h = typeof height === 'number';\n  var m = typeof mode === 'string';\n  pin._ts_transform = ++iid;\n  if (w) {\n    pin._scaleX = width / pin._width_;\n    pin._width = pin._width_;\n  }\n  if (h) {\n    pin._scaleY = height / pin._height_;\n    pin._height = pin._height_;\n  }\n  if (w && h && m) {\n    if (mode == 'out' || mode == 'out-crop') {\n      pin._scaleX = pin._scaleY = Math.max(pin._scaleX, pin._scaleY);\n    } else if (mode == 'in' || mode == 'in-pad') {\n      pin._scaleX = pin._scaleY = Math.min(pin._scaleX, pin._scaleY);\n    }\n    if (mode == 'out-crop' || mode == 'in-pad') {\n      pin._width = width / pin._scaleX;\n      pin._height = height / pin._scaleY;\n    }\n  }\n};\n\nClass.prototype.scaleTo = function(a, b, c) {\n  if (typeof a === 'object')\n    c = b, b = a.y, a = a.x;\n  scaleTo(this._pin, a, b, c);\n  return this;\n};\n\n// Used by Tween class\nPin._add_shortcuts = function(Class) {\n  Class.prototype.size = function(w, h) {\n    this.pin('width', w);\n    this.pin('height', h);\n    return this;\n  };\n\n  Class.prototype.width = function(w) {\n    if (typeof w === 'undefined') {\n      return this.pin('width');\n    }\n    this.pin('width', w);\n    return this;\n  };\n\n  Class.prototype.height = function(h) {\n    if (typeof h === 'undefined') {\n      return this.pin('height');\n    }\n    this.pin('height', h);\n    return this;\n  };\n\n  Class.prototype.offset = function(a, b) {\n    if (typeof a === 'object')\n      b = a.y, a = a.x;\n    this.pin('offsetX', a);\n    this.pin('offsetY', b);\n    return this;\n  };\n\n  Class.prototype.rotate = function(a) {\n    this.pin('rotation', a);\n    return this;\n  };\n\n  Class.prototype.skew = function(a, b) {\n    if (typeof a === 'object')\n      b = a.y, a = a.x;\n    else if (typeof b === 'undefined')\n      b = a;\n    this.pin('skewX', a);\n    this.pin('skewY', b);\n    return this;\n  };\n\n  Class.prototype.scale = function(a, b) {\n    if (typeof a === 'object')\n      b = a.y, a = a.x;\n    else if (typeof b === 'undefined')\n      b = a;\n    this.pin('scaleX', a);\n    this.pin('scaleY', b);\n    return this;\n  };\n\n  Class.prototype.alpha = function(a, ta) {\n    this.pin('alpha', a);\n    if (typeof ta !== 'undefined') {\n      this.pin('textureAlpha', ta);\n    }\n    return this;\n  };\n};\n\nPin._add_shortcuts(Class);\n\nmodule.exports = Pin;\n","var Class = require('./core');\nrequire('./pin');\nvar stats = require('./util/stats');\n\nClass.prototype._textures = null;\nClass.prototype._alpha = 1;\n\nClass.prototype.render = function(context) {\n  if (!this._visible) {\n    return;\n  }\n  stats.node++;\n\n  var m = this.matrix();\n  context.setTransform(m.a, m.b, m.c, m.d, m.e, m.f);\n\n  // move this elsewhere!\n  this._alpha = this._pin._alpha * (this._parent ? this._parent._alpha : 1);\n  var alpha = this._pin._textureAlpha * this._alpha;\n\n  if (context.globalAlpha != alpha) {\n    context.globalAlpha = alpha;\n  }\n\n  if (this._textures !== null) {\n    for (var i = 0, n = this._textures.length; i < n; i++) {\n      this._textures[i].draw(context);\n    }\n  }\n\n  if (context.globalAlpha != this._alpha) {\n    context.globalAlpha = this._alpha;\n  }\n\n  var child, next = this._first;\n  while (child = next) {\n    next = child._next;\n    child.render(context);\n  }\n};\n\nClass.prototype._tickBefore = null;\nClass.prototype._tickAfter = null;\nClass.prototype.MAX_ELAPSE = Infinity;\n\nClass.prototype._tick = function(elapsed, now, last) {\n  if (!this._visible) {\n    return;\n  }\n\n  if (elapsed > this.MAX_ELAPSE) {\n    elapsed = this.MAX_ELAPSE;\n  }\n\n  var ticked = false;\n\n  if (this._tickBefore !== null) {\n    for (var i = 0; i < this._tickBefore.length; i++) {\n      stats.tick++;\n      var tickFn = this._tickBefore[i];\n      ticked = tickFn.call(this, elapsed, now, last) === true || ticked;\n    }\n  }\n\n  var child, next = this._first;\n  while (child = next) {\n    next = child._next;\n    if (child._flag('_tick')) {\n      ticked = child._tick(elapsed, now, last) === true ? true : ticked;\n    }\n  }\n\n  if (this._tickAfter !== null) {\n    for (var i = 0; i < this._tickAfter.length; i++) {\n      stats.tick++;\n      var tickFn = this._tickAfter[i];\n      ticked = tickFn.call(this, elapsed, now, last) === true || ticked;\n    }\n  }\n\n  return ticked;\n};\n\nClass.prototype.tick = function(ticker, before) {\n  if (typeof ticker !== 'function') {\n    return;\n  }\n  if (before) {\n    if (this._tickBefore === null) {\n      this._tickBefore = [];\n    }\n    this._tickBefore.push(ticker);\n  } else {\n    if (this._tickAfter === null) {\n      this._tickAfter = [];\n    }\n    this._tickAfter.push(ticker);\n  }\n  this._flag('_tick', this._tickAfter !== null && this._tickAfter.length > 0\n      || this._tickBefore !== null && this._tickBefore.length > 0);\n};\n\nClass.prototype.untick = function(ticker) {\n  if (typeof ticker !== 'function') {\n    return;\n  }\n  var i;\n  if (this._tickBefore !== null && (i = this._tickBefore.indexOf(ticker)) >= 0) {\n    this._tickBefore.splice(i, 1);\n  }\n  if (this._tickAfter !== null && (i = this._tickAfter.indexOf(ticker)) >= 0) {\n    this._tickAfter.splice(i, 1);\n  }\n};\n\nClass.prototype.timeout = function(fn, time) {\n  this.setTimeout(fn, time);\n};\n\nClass.prototype.setTimeout = function(fn, time) {\n  function timer(t) {\n    if ((time -= t) < 0) {\n      this.untick(timer);\n      fn.call(this);\n    } else {\n      return true;\n    }\n  }\n  this.tick(timer);\n  return timer;\n};\n\nClass.prototype.clearTimeout = function(timer) {\n  this.untick(timer);\n};\n\n","module.exports = {};\n","module.exports = function(base) {\n  for (var i = 1; i < arguments.length; i++) {\n    var obj = arguments[i];\n    for ( var key in obj) {\n      if (obj.hasOwnProperty(key)) {\n        base[key] = obj[key];\n      }\n    }\n  }\n  return base;\n};\n","/**\n * ! is the definitive JavaScript type testing library\n * \n * @copyright 2013-2014 Enrico Marino / Jordan Harband\n * @license MIT\n */\n\nvar objProto = Object.prototype;\nvar owns = objProto.hasOwnProperty;\nvar toStr = objProto.toString;\n\nvar NON_HOST_TYPES = {\n  'boolean' : 1,\n  'number' : 1,\n  'string' : 1,\n  'undefined' : 1\n};\n\nvar hexRegex = /^[A-Fa-f0-9]+$/;\n\nvar is = module.exports = {};\n\nis.a = is.an = is.type = function(value, type) {\n  return typeof value === type;\n};\n\nis.defined = function(value) {\n  return typeof value !== 'undefined';\n};\n\nis.empty = function(value) {\n  var type = toStr.call(value);\n  var key;\n\n  if ('[object Array]' === type || '[object Arguments]' === type\n      || '[object String]' === type) {\n    return value.length === 0;\n  }\n\n  if ('[object Object]' === type) {\n    for (key in value) {\n      if (owns.call(value, key)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  return !value;\n};\n\nis.equal = function(value, other) {\n  if (value === other) {\n    return true;\n  }\n\n  var type = toStr.call(value);\n  var key;\n\n  if (type !== toStr.call(other)) {\n    return false;\n  }\n\n  if ('[object Object]' === type) {\n    for (key in value) {\n      if (!is.equal(value[key], other[key]) || !(key in other)) {\n        return false;\n      }\n    }\n    for (key in other) {\n      if (!is.equal(value[key], other[key]) || !(key in value)) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  if ('[object Array]' === type) {\n    key = value.length;\n    if (key !== other.length) {\n      return false;\n    }\n    while (--key) {\n      if (!is.equal(value[key], other[key])) {\n        return false;\n      }\n    }\n    return true;\n  }\n\n  if ('[object Function]' === type) {\n    return value.prototype === other.prototype;\n  }\n\n  if ('[object Date]' === type) {\n    return value.getTime() === other.getTime();\n  }\n\n  return false;\n};\n\nis.instance = function(value, constructor) {\n  return value instanceof constructor;\n};\n\nis.nil = function(value) {\n  return value === null;\n};\n\nis.undef = function(value) {\n  return typeof value === 'undefined';\n};\n\nis.array = function(value) {\n  return '[object Array]' === toStr.call(value);\n};\n\nis.emptyarray = function(value) {\n  return is.array(value) && value.length === 0;\n};\n\nis.arraylike = function(value) {\n  return !!value && !is.boolean(value) && owns.call(value, 'length')\n      && isFinite(value.length) && is.number(value.length) && value.length >= 0;\n};\n\nis.boolean = function(value) {\n  return '[object Boolean]' === toStr.call(value);\n};\n\nis.element = function(value) {\n  return value !== undefined && typeof HTMLElement !== 'undefined'\n      && value instanceof HTMLElement && value.nodeType === 1;\n};\n\nis.fn = function(value) {\n  return '[object Function]' === toStr.call(value);\n};\n\nis.number = function(value) {\n  return '[object Number]' === toStr.call(value);\n};\n\nis.nan = function(value) {\n  return !is.number(value) || value !== value;\n};\n\nis.object = function(value) {\n  return '[object Object]' === toStr.call(value);\n};\n\nis.hash = function(value) {\n  return is.object(value) && value.constructor === Object && !value.nodeType\n      && !value.setInterval;\n};\n\nis.regexp = function(value) {\n  return '[object RegExp]' === toStr.call(value);\n};\n\nis.string = function(value) {\n  return '[object String]' === toStr.call(value);\n};\n\nis.hex = function(value) {\n  return is.string(value) && (!value.length || hexRegex.test(value));\n};\n","var stats = require('./util/stats');\nvar math = require('./util/math');\n\nfunction Texture(image, ratio) {\n  if (typeof image === 'object') {\n    this.src(image, ratio);\n  }\n}\n\nTexture.prototype.pipe = function() {\n  return new Texture(this);\n};\n\n/**\n * Signatures: (image), (x, y, w, h), (w, h)\n */\nTexture.prototype.src = function(x, y, w, h) {\n  if (typeof x === 'object') {\n    var image = x, ratio = y || 1;\n\n    this._image = image;\n    this._sx = this._dx = 0;\n    this._sy = this._dy = 0;\n    this._sw = this._dw = image.width / ratio;\n    this._sh = this._dh = image.height / ratio;\n\n    this.width = image.width / ratio;\n    this.height = image.height / ratio;\n\n    this.ratio = ratio;\n\n  } else {\n    if (typeof w === 'undefined') {\n      w = x, h = y;\n    } else {\n      this._sx = x, this._sy = y;\n    }\n    this._sw = this._dw = w;\n    this._sh = this._dh = h;\n\n    this.width = w;\n    this.height = h;\n  }\n  return this;\n};\n\n/**\n * Signatures: (x, y, w, h), (x, y)\n */\nTexture.prototype.dest = function(x, y, w, h) {\n  this._dx = x, this._dy = y;\n  this._dx = x, this._dy = y;\n  if (typeof w !== 'undefined') {\n    this._dw = w, this._dh = h;\n    this.width = w, this.height = h;\n  }\n  return this;\n};\n\nTexture.prototype.draw = function(context, x1, y1, x2, y2, x3, y3, x4, y4) {\n  var image = this._image;\n  if (image === null || typeof image !== 'object') {\n    return;\n  }\n\n  var sx = this._sx, sy = this._sy;\n  var sw = this._sw, sh = this._sh;\n  var dx = this._dx, dy = this._dy;\n  var dw = this._dw, dh = this._dh;\n\n  if (typeof x3 !== 'undefined') {\n    x1 = math.limit(x1, 0, this._sw), x2 = math.limit(x2, 0, this._sw - x1);\n    y1 = math.limit(y1, 0, this._sh), y2 = math.limit(y2, 0, this._sh - y1);\n    sx += x1, sy += y1, sw = x2, sh = y2;\n    dx = x3, dy = y3, dw = x4, dh = y4;\n\n  } else if (typeof x2 !== 'undefined') {\n    dx = x1, dy = y1, dw = x2, dh = y2;\n\n  } else if (typeof x1 !== 'undefined') {\n    dw = x1, dh = y1;\n  }\n\n  var ratio = this.ratio || 1;\n  sx *= ratio, sy *= ratio, sw *= ratio, sh *= ratio;\n\n  try {\n    if (typeof image.draw === 'function') {\n      image.draw(context, sx, sy, sw, sh, dx, dy, dw, dh);\n    } else {\n      stats.draw++;\n      context.drawImage(image, sx, sy, sw, sh, dx, dy, dw, dh);\n    }\n  } catch (ex) {\n    if (!image._draw_failed) {\n      console.log('Unable to draw: ', image);\n      console.log(ex);\n      image._draw_failed = true;\n    }\n  }\n};\n\nmodule.exports = Texture;\n","var create = require('./create');\nvar native = Math;\n\nmodule.exports = create(Math);\n\nmodule.exports.random = function(min, max) {\n  if (typeof min === 'undefined') {\n    max = 1, min = 0;\n  } else if (typeof max === 'undefined') {\n    max = min, min = 0;\n  }\n  return min == max ? min : native.random() * (max - min) + min;\n};\n\nmodule.exports.rotate = function(num, min, max) {\n  if (typeof min === 'undefined') {\n    max = 1, min = 0;\n  } else if (typeof max === 'undefined') {\n    max = min, min = 0;\n  }\n  if (max > min) {\n    num = (num - min) % (max - min);\n    return num + (num < 0 ? max : min);\n  } else {\n    num = (num - max) % (min - max);\n    return num + (num <= 0 ? min : max);\n  }\n};\n\nmodule.exports.limit = function(num, min, max) {\n  if (num < min) {\n    return min;\n  } else if (num > max) {\n    return max;\n  } else {\n    return num;\n  }\n};\n\nmodule.exports.length = function(x, y) {\n  return native.sqrt(x * x + y * y);\n};","function Matrix(a, b, c, d, e, f) {\n  this.reset(a, b, c, d, e, f);\n};\n\nMatrix.prototype.toString = function() {\n  return '[' + this.a + ', ' + this.b + ', ' + this.c + ', ' + this.d + ', '\n      + this.e + ', ' + this.f + ']';\n};\n\nMatrix.prototype.clone = function() {\n  return new Matrix(this.a, this.b, this.c, this.d, this.e, this.f);\n};\n\nMatrix.prototype.reset = function(a, b, c, d, e, f) {\n  this._dirty = true;\n  if (typeof a === 'object') {\n    this.a = a.a, this.d = a.d;\n    this.b = a.b, this.c = a.c;\n    this.e = a.e, this.f = a.f;\n  } else {\n    this.a = a || 1, this.d = d || 1;\n    this.b = b || 0, this.c = c || 0;\n    this.e = e || 0, this.f = f || 0;\n  }\n  return this;\n};\n\nMatrix.prototype.identity = function() {\n  this._dirty = true;\n  this.a = 1;\n  this.b = 0;\n  this.c = 0;\n  this.d = 1;\n  this.e = 0;\n  this.f = 0;\n  return this;\n};\n\nMatrix.prototype.rotate = function(angle) {\n  if (!angle) {\n    return this;\n  }\n\n  this._dirty = true;\n\n  var u = angle ? Math.cos(angle) : 1;\n  // android bug may give bad 0 values\n  var v = angle ? Math.sin(angle) : 0;\n\n  var a = u * this.a - v * this.b;\n  var b = u * this.b + v * this.a;\n  var c = u * this.c - v * this.d;\n  var d = u * this.d + v * this.c;\n  var e = u * this.e - v * this.f;\n  var f = u * this.f + v * this.e;\n\n  this.a = a;\n  this.b = b;\n  this.c = c;\n  this.d = d;\n  this.e = e;\n  this.f = f;\n\n  return this;\n};\n\nMatrix.prototype.translate = function(x, y) {\n  if (!x && !y) {\n    return this;\n  }\n  this._dirty = true;\n  this.e += x;\n  this.f += y;\n  return this;\n};\n\nMatrix.prototype.scale = function(x, y) {\n  if (!(x - 1) && !(y - 1)) {\n    return this;\n  }\n  this._dirty = true;\n  this.a *= x;\n  this.b *= y;\n  this.c *= x;\n  this.d *= y;\n  this.e *= x;\n  this.f *= y;\n  return this;\n};\n\nMatrix.prototype.skew = function(x, y) {\n  if (!x && !y) {\n    return this;\n  }\n  this._dirty = true;\n\n  var a = this.a + this.b * x;\n  var b = this.b + this.a * y;\n  var c = this.c + this.d * x;\n  var d = this.d + this.c * y;\n  var e = this.e + this.f * x;\n  var f = this.f + this.e * y;\n\n  this.a = a;\n  this.b = b;\n  this.c = c;\n  this.d = d;\n  this.e = e;\n  this.f = f;\n  return this;\n};\n\nMatrix.prototype.concat = function(m) {\n  this._dirty = true;\n\n  var n = this;\n\n  var a = n.a * m.a + n.b * m.c;\n  var b = n.b * m.d + n.a * m.b;\n  var c = n.c * m.a + n.d * m.c;\n  var d = n.d * m.d + n.c * m.b;\n  var e = n.e * m.a + m.e + n.f * m.c;\n  var f = n.f * m.d + m.f + n.e * m.b;\n\n  this.a = a;\n  this.b = b;\n  this.c = c;\n  this.d = d;\n  this.e = e;\n  this.f = f;\n\n  return this;\n};\n\nMatrix.prototype.inverse = Matrix.prototype.reverse = function() {\n  if (this._dirty) {\n    this._dirty = false;\n    this.inversed = this.inversed || new Matrix();\n    var z = this.a * this.d - this.b * this.c;\n    this.inversed.a = this.d / z;\n    this.inversed.b = -this.b / z;\n    this.inversed.c = -this.c / z;\n    this.inversed.d = this.a / z;\n    this.inversed.e = (this.c * this.f - this.e * this.d) / z;\n    this.inversed.f = (this.e * this.b - this.a * this.f) / z;\n  }\n  return this.inversed;\n};\n\nMatrix.prototype.map = function(p, q) {\n  q = q || {};\n  q.x = this.a * p.x + this.c * p.y + this.e;\n  q.y = this.b * p.x + this.d * p.y + this.f;\n  return q;\n};\n\nMatrix.prototype.mapX = function(x, y) {\n  if (typeof x === 'object')\n    y = x.y, x = x.x;\n  return this.a * x + this.c * y + this.e;\n};\n\nMatrix.prototype.mapY = function(x, y) {\n  if (typeof x === 'object')\n    y = x.y, x = x.x;\n  return this.b * x + this.d * y + this.f;\n};\n\nmodule.exports = Matrix;\n","module.exports = require('./core');\nmodule.exports.Matrix = require('./matrix');\nmodule.exports.Texture = require('./texture');\nrequire('./atlas');\nrequire('./tree');\nrequire('./event');\nrequire('./pin');\n\nrequire('./loop');\nrequire('./root');","module.exports = function() {\n  var count = 0;\n  function fork(fn, n) {\n    count += n = (typeof n === 'number' && n >= 1 ? n : 1);\n    return function() {\n      fn && fn.apply(this, arguments);\n      if (n > 0) {\n        n--, count--, call();\n      }\n    };\n  }\n  var then = [];\n  function call() {\n    if (count === 0) {\n      while (then.length) {\n        setTimeout(then.shift(), 0);\n      }\n    }\n  }\n  fork.then = function(fn) {\n    if (count === 0) {\n      setTimeout(fn, 0);\n    } else {\n      then.push(fn);\n    }\n  };\n  return fork;\n};","var STAGE_DEBUG = typeof DEBUG === 'undefined' ? false : !!DEBUG;\n\nvar Class = require('./core');\nvar Texture = require('./texture');\n\nvar extend = require('./util/extend');\nvar create = require('./util/create');\nvar is = require('./util/is');\n\nvar string = require('./util/string');\n\n// name : atlas\nvar _atlases_map = {};\n// [atlas]\nvar _atlases_arr = [];\n\n// TODO: print subquery not found error\n// TODO: index textures\n\nClass.atlas = function(def) {\n  var atlas = is.fn(def.draw) ? def : new Atlas(def);\n  if (def.name) {\n    _atlases_map[def.name] = atlas;\n  }\n  _atlases_arr.push(atlas);\n\n  deprecated(def, 'imagePath');\n  deprecated(def, 'imageRatio');\n\n  var url = def.imagePath;\n  var ratio = def.imageRatio || 1;\n  if (is.string(def.image)) {\n    url = def.image;\n  } else if (is.hash(def.image)) {\n    url = def.image.src || def.image.url;\n    ratio = def.image.ratio || ratio;\n  }\n  url && Class.preload(function(done) {\n    url = Class.resolve(url);\n    STAGE_DEBUG && console.log('Loading atlas: ' + url);\n    var imageloader = Class.config('image-loader');\n\n    imageloader(url, function(image) {\n      STAGE_DEBUG && console.log('Image loaded: ' + url);\n      atlas.src(image, ratio);\n      done();\n\n    }, function(err) {\n      STAGE_DEBUG && console.log('Error loading atlas: ' + url, err);\n      done();\n    });\n  });\n\n  return atlas;\n};\n\nAtlas._super = Texture;\nAtlas.prototype = create(Atlas._super.prototype);\n\nfunction Atlas(def) {\n  Atlas._super.call(this);\n\n  var atlas = this;\n\n  deprecated(def, 'filter');\n  deprecated(def, 'cutouts');\n  deprecated(def, 'sprites');\n  deprecated(def, 'factory');\n\n  var map = def.map || def.filter;\n  var ppu = def.ppu || def.ratio || 1;\n  var trim = def.trim || 0;\n  var textures = def.textures;\n  var factory = def.factory;\n  var cutouts = def.cutouts || def.sprites;\n\n  function make(def) {\n    if (!def || is.fn(def.draw)) {\n      return def;\n    }\n\n    def = extend({}, def);\n\n    if (is.fn(map)) {\n      def = map(def);\n    }\n\n    if (ppu != 1) {\n      def.x *= ppu, def.y *= ppu;\n      def.width *= ppu, def.height *= ppu;\n      def.top *= ppu, def.bottom *= ppu;\n      def.left *= ppu, def.right *= ppu;\n    }\n\n    if (trim != 0) {\n      def.x += trim, def.y += trim;\n      def.width -= 2 * trim, def.height -= 2 * trim;\n      def.top -= trim, def.bottom -= trim;\n      def.left -= trim, def.right -= trim;\n    }\n\n    var texture = atlas.pipe();\n    texture.top = def.top, texture.bottom = def.bottom;\n    texture.left = def.left, texture.right = def.right;\n    texture.src(def.x, def.y, def.width, def.height);\n    return texture;\n  }\n\n  function find(query) {\n    if (textures) {\n      if (is.fn(textures)) {\n        return textures(query);\n      } else if (is.hash(textures)) {\n        return textures[query];\n      }\n    }\n    if (cutouts) { // deprecated\n      var result = null, n = 0;\n      for (var i = 0; i < cutouts.length; i++) {\n        if (string.startsWith(cutouts[i].name, query)) {\n          if (n === 0) {\n            result = cutouts[i];\n          } else if (n === 1) {\n            result = [ result, cutouts[i] ];\n          } else {\n            result.push(cutouts[i]);\n          }\n          n++;\n        }\n      }\n      if (n === 0 && is.fn(factory)) {\n        result = function(subquery) {\n          return factory(query + (subquery ? subquery : ''));\n        };\n      }\n      return result;\n    }\n  }\n\n  this.select = function(query) {\n    if (!query) {\n      // TODO: if `textures` is texture def, map or fn?\n      return new Selection(this.pipe());\n    }\n    var found = find(query);\n    if (found) {\n      return new Selection(found, find, make);\n    }\n  };\n\n};\n\nvar nfTexture = new Texture();\nnfTexture.x = nfTexture.y = nfTexture.width = nfTexture.height = 0;\nnfTexture.pipe = nfTexture.src = nfTexture.dest = function() {\n  return this;\n};\nnfTexture.draw = function() {\n};\n\nvar nfSelection = new Selection(nfTexture);\n\nfunction Selection(result, find, make) {\n  function link(result, subquery) {\n    if (!result) {\n      return nfTexture;\n\n    } else if (is.fn(result.draw)) {\n      return result;\n\n    } else if (is.hash(result) && is.number(result.width)\n        && is.number(result.height) && is.fn(make)) {\n      return make(result);\n\n    } else if (is.hash(result) && is.defined(subquery)) {\n      return link(result[subquery]);\n\n    } else if (is.fn(result)) {\n      return link(result(subquery));\n\n    } else if (is.array(result)) {\n      return link(result[0]);\n\n    } else if (is.string(result) && is.fn(find)) {\n      return link(find(result));\n    }\n  }\n\n  this.one = function(subquery) {\n    return link(result, subquery);\n  };\n\n  this.array = function(arr) {\n    var array = is.array(arr) ? arr : [];\n    if (is.array(result)) {\n      for (var i = 0; i < result.length; i++) {\n        array[i] = link(result[i]);\n      }\n    } else {\n      array[0] = link(result);\n    }\n    return array;\n  };\n}\n\nClass.texture = function(query) {\n  if (!is.string(query)) {\n    return new Selection(query);\n  }\n\n  var result = null, atlas, i;\n\n  if ((i = query.indexOf(':')) > 0 && query.length > i + 1) {\n    atlas = _atlases_map[query.slice(0, i)];\n    result = atlas && atlas.select(query.slice(i + 1));\n  }\n\n  if (!result && (atlas = _atlases_map[query])) {\n    result = atlas.select();\n  }\n\n  for (i = 0; !result && i < _atlases_arr.length; i++) {\n    result = _atlases_arr[i].select(query);\n  }\n\n  if (!result) {\n    console.error('Texture not found: ' + query);\n    result = nfSelection;\n  }\n\n  return result;\n};\n\nfunction deprecated(hash, name, msg) {\n  if (name in hash)\n    console.log(msg ? msg.replace('%name', name) : '\\'' + name\n        + '\\' field of texture atlas is deprecated.');\n};\n\nmodule.exports = Atlas;\n","module.exports.startsWith = function(str, sub) {\n  return typeof str === 'string' && typeof sub === 'string'\n      && str.substring(0, sub.length) == sub;\n};","var Class = require('./core');\nvar is = require('./util/is');\n\nvar iid = 0;\n\n// TODO: do not clear next/prev/parent on remove\n\nClass.prototype._label = '';\n\nClass.prototype._visible = true;\n\nClass.prototype._parent = null;\nClass.prototype._next = null;\nClass.prototype._prev = null;\n\nClass.prototype._first = null;\nClass.prototype._last = null;\n\nClass.prototype._attrs = null;\nClass.prototype._flags = null;\n\nClass.prototype.toString = function() {\n  return '[' + this._label + ']';\n};\n\n/**\n * @deprecated Use label()\n */\nClass.prototype.id = function(id) {\n  return this.label(id);\n};\n\nClass.prototype.label = function(label) {\n  if (typeof label === 'undefined') {\n    return this._label;\n  }\n  this._label = label;\n  return this;\n};\n\nClass.prototype.attr = function(name, value) {\n  if (typeof value === 'undefined') {\n    return this._attrs !== null ? this._attrs[name] : undefined;\n  }\n  (this._attrs !== null ? this._attrs : this._attrs = {})[name] = value;\n  return this;\n};\n\nClass.prototype.visible = function(visible) {\n  if (typeof visible === 'undefined') {\n    return this._visible;\n  }\n  this._visible = visible;\n  this._parent && (this._parent._ts_children = ++iid);\n  this._ts_pin = ++iid;\n  this.touch();\n  return this;\n};\n\nClass.prototype.hide = function() {\n  return this.visible(false);\n};\n\nClass.prototype.show = function() {\n  return this.visible(true);\n};\n\nClass.prototype.parent = function() {\n  return this._parent;\n};\n\nClass.prototype.next = function(visible) {\n  var next = this._next;\n  while (next && visible && !next._visible) {\n    next = next._next;\n  }\n  return next;\n};\n\nClass.prototype.prev = function(visible) {\n  var prev = this._prev;\n  while (prev && visible && !prev._visible) {\n    prev = prev._prev;\n  }\n  return prev;\n};\n\nClass.prototype.first = function(visible) {\n  var next = this._first;\n  while (next && visible && !next._visible) {\n    next = next._next;\n  }\n  return next;\n};\n\nClass.prototype.last = function(visible) {\n  var prev = this._last;\n  while (prev && visible && !prev._visible) {\n    prev = prev._prev;\n  }\n  return prev;\n};\n\nClass.prototype.visit = function(visitor, data) {\n  var reverse = visitor.reverse;\n  var visible = visitor.visible;\n  if (visitor.start && visitor.start(this, data)) {\n    return;\n  }\n  var child, next = reverse ? this.last(visible) : this.first(visible);\n  while (child = next) {\n    next = reverse ? child.prev(visible) : child.next(visible);\n    if (child.visit(visitor, data)) {\n      return true;\n    }\n  }\n  return visitor.end && visitor.end(this, data);\n};\n\nClass.prototype.append = function(child, more) {\n  if (is.array(child))\n    for (var i = 0; i < child.length; i++)\n      append(this, child[i]);\n\n  else if (typeof more !== 'undefined') // deprecated\n    for (var i = 0; i < arguments.length; i++)\n      append(this, arguments[i]);\n\n  else if (typeof child !== 'undefined')\n    append(this, child);\n\n  return this;\n};\n\nClass.prototype.prepend = function(child, more) {\n  if (is.array(child))\n    for (var i = child.length - 1; i >= 0; i--)\n      prepend(this, child[i]);\n\n  else if (typeof more !== 'undefined') // deprecated\n    for (var i = arguments.length - 1; i >= 0; i--)\n      prepend(this, arguments[i]);\n\n  else if (typeof child !== 'undefined')\n    prepend(this, child);\n\n  return this;\n};\n\nClass.prototype.appendTo = function(parent) {\n  append(parent, this);\n  return this;\n};\n\nClass.prototype.prependTo = function(parent) {\n  prepend(parent, this);\n  return this;\n};\n\nClass.prototype.insertNext = function(sibling, more) {\n  if (is.array(sibling))\n    for (var i = 0; i < sibling.length; i++)\n      insertAfter(sibling[i], this);\n\n  else if (typeof more !== 'undefined') // deprecated\n    for (var i = 0; i < arguments.length; i++)\n      insertAfter(arguments[i], this);\n\n  else if (typeof sibling !== 'undefined')\n    insertAfter(sibling, this);\n\n  return this;\n};\n\nClass.prototype.insertPrev = function(sibling, more) {\n  if (is.array(sibling))\n    for (var i = sibling.length - 1; i >= 0; i--)\n      insertBefore(sibling[i], this);\n\n  else if (typeof more !== 'undefined') // deprecated\n    for (var i = arguments.length - 1; i >= 0; i--)\n      insertBefore(arguments[i], this);\n\n  else if (typeof sibling !== 'undefined')\n    insertBefore(sibling, this);\n\n  return this;\n};\n\nClass.prototype.insertAfter = function(prev) {\n  insertAfter(this, prev);\n  return this;\n};\n\nClass.prototype.insertBefore = function(next) {\n  insertBefore(this, next);\n  return this;\n};\n\nfunction append(parent, child) {\n  _ensure(child);\n  _ensure(parent);\n\n  child.remove();\n\n  if (parent._last) {\n    parent._last._next = child;\n    child._prev = parent._last;\n  }\n\n  child._parent = parent;\n  parent._last = child;\n\n  if (!parent._first) {\n    parent._first = child;\n  }\n\n  child._parent._flag(child, true);\n\n  child._ts_parent = ++iid;\n  parent._ts_children = ++iid;\n  parent.touch();\n}\n\nfunction prepend(parent, child) {\n  _ensure(child);\n  _ensure(parent);\n\n  child.remove();\n\n  if (parent._first) {\n    parent._first._prev = child;\n    child._next = parent._first;\n  }\n\n  child._parent = parent;\n  parent._first = child;\n\n  if (!parent._last) {\n    parent._last = child;\n  }\n\n  child._parent._flag(child, true);\n\n  child._ts_parent = ++iid;\n  parent._ts_children = ++iid;\n  parent.touch();\n};\n\nfunction insertBefore(self, next) {\n  _ensure(self);\n  _ensure(next);\n\n  self.remove();\n\n  var parent = next._parent;\n  var prev = next._prev;\n\n  next._prev = self;\n  prev && (prev._next = self) || parent && (parent._first = self);\n\n  self._parent = parent;\n  self._prev = prev;\n  self._next = next;\n\n  self._parent._flag(self, true);\n\n  self._ts_parent = ++iid;\n  self.touch();\n};\n\nfunction insertAfter(self, prev) {\n  _ensure(self);\n  _ensure(prev);\n\n  self.remove();\n\n  var parent = prev._parent;\n  var next = prev._next;\n\n  prev._next = self;\n  next && (next._prev = self) || parent && (parent._last = self);\n\n  self._parent = parent;\n  self._prev = prev;\n  self._next = next;\n\n  self._parent._flag(self, true);\n\n  self._ts_parent = ++iid;\n  self.touch();\n};\n\nClass.prototype.remove = function(child, more) {\n  if (typeof child !== 'undefined') {\n    if (is.array(child)) {\n      for (var i = 0; i < child.length; i++)\n        _ensure(child[i]).remove();\n\n    } else if (typeof more !== 'undefined') {\n      for (var i = 0; i < arguments.length; i++)\n        _ensure(arguments[i]).remove();\n\n    } else {\n      _ensure(child).remove();\n    }\n    return this;\n  }\n\n  if (this._prev) {\n    this._prev._next = this._next;\n  }\n  if (this._next) {\n    this._next._prev = this._prev;\n  }\n\n  if (this._parent) {\n    if (this._parent._first === this) {\n      this._parent._first = this._next;\n    }\n    if (this._parent._last === this) {\n      this._parent._last = this._prev;\n    }\n\n    this._parent._flag(this, false);\n\n    this._parent._ts_children = ++iid;\n    this._parent.touch();\n  }\n\n  this._prev = this._next = this._parent = null;\n  this._ts_parent = ++iid;\n  // this._parent.touch();\n\n  return this;\n};\n\nClass.prototype.empty = function() {\n  var child, next = this._first;\n  while (child = next) {\n    next = child._next;\n    child._prev = child._next = child._parent = null;\n\n    this._flag(child, false);\n  }\n\n  this._first = this._last = null;\n\n  this._ts_children = ++iid;\n  this.touch();\n  return this;\n};\n\nClass.prototype.touch = function() {\n  this._ts_touch = ++iid;\n  this._parent && this._parent.touch();\n  return this;\n};\n\n/**\n * Deep flags used for optimizing event distribution.\n */\nClass.prototype._flag = function(obj, name) {\n  if (typeof name === 'undefined') {\n    return this._flags !== null && this._flags[obj] || 0;\n  }\n  if (typeof obj === 'string') {\n    if (name) {\n      this._flags = this._flags || {};\n      if (!this._flags[obj] && this._parent) {\n        this._parent._flag(obj, true);\n      }\n      this._flags[obj] = (this._flags[obj] || 0) + 1;\n\n    } else if (this._flags && this._flags[obj] > 0) {\n      if (this._flags[obj] == 1 && this._parent) {\n        this._parent._flag(obj, false);\n      }\n      this._flags[obj] = this._flags[obj] - 1;\n    }\n  }\n  if (typeof obj === 'object') {\n    if (obj._flags) {\n      for ( var type in obj._flags) {\n        if (obj._flags[type] > 0) {\n          this._flag(type, name);\n        }\n      }\n    }\n  }\n  return this;\n};\n\n/**\n * @private\n */\nClass.prototype.hitTest = function(hit) {\n  var width = this._pin._width;\n  var height = this._pin._height;\n  return hit.x >= 0 && hit.x <= width && hit.y >= 0 && hit.y <= height;\n};\n\nfunction _ensure(obj) {\n  if (obj && obj instanceof Class) {\n    return obj;\n  }\n  throw 'Invalid node: ' + obj;\n};\n\nmodule.exports = Class;\n","require('./util/event')(require('./core').prototype, function(obj, name, on) {\n  obj._flag(name, on);\n});\n","module.exports = function(prototype, callback) {\n\n  prototype._listeners = null;\n\n  prototype.on = prototype.listen = function(types, listener) {\n    if (!types || !types.length || typeof listener !== 'function') {\n      return this;\n    }\n    if (this._listeners === null) {\n      this._listeners = {};\n    }\n    var isarray = typeof types !== 'string' && typeof types.join === 'function';\n    if (types = (isarray ? types.join(' ') : types).match(/\\S+/g)) {\n      for (var i = 0; i < types.length; i++) {\n        var type = types[i];\n        this._listeners[type] = this._listeners[type] || [];\n        this._listeners[type].push(listener);\n        if (typeof callback === 'function') {\n          callback(this, type, true);\n        }\n      }\n    }\n    return this;\n  };\n\n  prototype.off = function(types, listener) {\n    if (!types || !types.length || typeof listener !== 'function') {\n      return this;\n    }\n    if (this._listeners === null) {\n      return this;\n    }\n    var isarray = typeof types !== 'string' && typeof types.join === 'function';\n    if (types = (isarray ? types.join(' ') : types).match(/\\S+/g)) {\n      for (var i = 0; i < types.length; i++) {\n        var type = types[i], all = this._listeners[type], index;\n        if (all && (index = all.indexOf(listener)) >= 0) {\n          all.splice(index, 1);\n          if (!all.length) {\n            delete this._listeners[type];\n          }\n          if (typeof callback === 'function') {\n            callback(this, type, false);\n          }\n        }\n      }\n    }\n    return this;\n  };\n\n  prototype.listeners = function(type) {\n    return this._listeners && this._listeners[type];\n  };\n\n  prototype.publish = function(name, args) {\n    var listeners = this.listeners(name);\n    if (!listeners || !listeners.length) {\n      return 0;\n    }\n    for (var l = 0; l < listeners.length; l++) {\n      listeners[l].apply(this, args);\n    }\n    return listeners.length;\n  };\n\n  prototype.trigger = function(name, args) {\n    this.publish(name, args);\n    return this;\n  };\n\n};\n","var Class = require('./core');\nrequire('./pin');\nrequire('./loop');\n\nvar stats = require('./util/stats');\nvar create = require('./util/create');\nvar extend = require('./util/extend');\n\nRoot._super = Class;\nRoot.prototype = create(Root._super.prototype);\n\nClass.root = function(request, render) {\n  return new Root(request, render);\n};\n\nfunction Root(request, render) {\n  Root._super.call(this);\n  this.label('Root');\n\n  var paused = true;\n  var stopped = true;\n\n  var self = this;\n  var lastTime = 0;\n  var loop = function(now) {\n    if (paused === true || stopped === true) {\n      return;\n    }\n\n    stats.tick = stats.node = stats.draw = 0;\n\n    var last = lastTime || now;\n    var elapsed = now - last;\n    lastTime = now;\n\n    var ticked = self._tick(elapsed, now, last);\n    if (self._mo_touch != self._ts_touch) {\n      self._mo_touch = self._ts_touch;\n      render(self);\n      request(loop);\n    } else if (ticked) {\n      request(loop);\n    } else {\n      paused = true;\n    }\n\n    stats.fps = elapsed ? 1000 / elapsed : 0;\n  };\n\n  this.start = function() {\n    stopped = false;\n    return this.resume();\n  };\n\n  this.resume = function() {\n    if (paused) {\n      this.publish('resume');\n      paused = false;\n      request(loop);\n    }\n    return this;\n  };\n\n  this.pause = function() {\n    if (!paused) {\n      this.publish('pause');\n    }\n    paused = true;\n    return this;\n  };\n\n  this.touch_root = this.touch;\n  this.touch = function() {\n    this.resume();\n    return this.touch_root();\n  };\n  this.stop = function() {\n    stopped = true;\n    return this;\n  };\n};\n\nRoot.prototype.background = function(color) {\n  // to be implemented by loaders\n  return this;\n};\n\nRoot.prototype.viewport = function(width, height, ratio) {\n  if (typeof width === 'undefined') {\n    return extend({}, this._viewport);\n  }\n  this._viewport = {\n    width : width,\n    height : height,\n    ratio : ratio || 1\n  };\n  this.viewbox();\n  var data = extend({}, this._viewport);\n  this.visit({\n    start : function(node) {\n      if (!node._flag('viewport')) {\n        return true;\n      }\n      node.publish('viewport', [ data ]);\n    }\n  });\n  return this;\n};\n\n// TODO: static/fixed viewbox\nRoot.prototype.viewbox = function(width, height, mode) {\n  if (typeof width === 'number' && typeof height === 'number') {\n    this._viewbox = {\n      width : width,\n      height : height,\n      mode : /^(in|out|in-pad|out-crop)$/.test(mode) ? mode : 'in-pad'\n    };\n  }\n\n  var box = this._viewbox;\n  var size = this._viewport;\n  if (size && box) {\n    this.pin({\n      width : box.width,\n      height : box.height\n    });\n    this.scaleTo(size.width, size.height, box.mode);\n  } else if (size) {\n    this.pin({\n      width : size.width,\n      height : size.height\n    });\n  }\n\n  return this;\n};\n","var Class = require('./core');\nvar Texture = require('./texture');\n\nClass.canvas = function(type, attributes, drawFn) {\n  if (typeof type === 'string') {\n    if (typeof attributes === 'object') {\n    } else {\n      if (typeof attributes === 'function') {\n        drawFn = attributes;\n      }\n      attributes = {};\n    }\n  } else {\n    if (typeof type === 'function') {\n      drawFn = type;\n    }\n    attributes = {};\n    type = '2d';\n  }\n\n  var canvas = document.createElement('canvas');\n  var context = canvas.getContext(type, attributes);\n  var texture = new Texture(canvas);\n\n  texture.context = function() {\n    return context;\n  };\n\n  texture.size = function(width, height, ratio) {\n    ratio = ratio || 1;\n    canvas.width = width * ratio;\n    canvas.height = height * ratio;\n    this.src(canvas, ratio);\n    return this;\n  };\n\n  texture.canvas = function(fn) {\n    if (typeof fn === 'function') {\n      fn.call(this, context);\n    } else if (typeof fn === 'undefined' && typeof drawFn === 'function') {\n      drawFn.call(this, context);\n    }\n    return this;\n  };\n\n  if (typeof drawFn === 'function') {\n    drawFn.call(texture, context);\n  }\n\n  return texture;\n};","var Class = require('./core');\nrequire('./pin');\nrequire('./loop');\n\nvar repeat = require('./util/repeat');\nvar create = require('./util/create');\n\nmodule.exports = Image;\n\nClass.image = function(image) {\n  var img = new Image();\n  image && img.image(image);\n  return img;\n};\n\nImage._super = Class;\nImage.prototype = create(Image._super.prototype);\n\nfunction Image() {\n  Image._super.call(this);\n  this.label('Image');\n  this._textures = [];\n  this._image = null;\n};\n\n/**\n * @deprecated Use image\n */\nImage.prototype.setImage = function(a, b, c) {\n  return this.image(a, b, c);\n};\n\nImage.prototype.image = function(image) {\n  this._image = Class.texture(image).one();\n  this.pin('width', this._image ? this._image.width : 0);\n  this.pin('height', this._image ? this._image.height : 0);\n  this._textures[0] = this._image.pipe();\n  this._textures.length = 1;\n  return this;\n};\n\nImage.prototype.tile = function(inner) {\n  this._repeat(false, inner);\n  return this;\n};\n\nImage.prototype.stretch = function(inner) {\n  this._repeat(true, inner);\n  return this;\n};\n\nImage.prototype._repeat = function(stretch, inner) {\n  var self = this;\n  this.untick(this._repeatTicker);\n  this.tick(this._repeatTicker = function() {\n    if (this._mo_stretch == this._pin._ts_transform) {\n      return;\n    }\n    this._mo_stretch = this._pin._ts_transform;\n    var width = this.pin('width');\n    var height = this.pin('height');\n    this._textures.length = repeat(this._image, width, height, stretch, inner,\n        insert);\n  });\n\n  function insert(i, sx, sy, sw, sh, dx, dy, dw, dh) {\n    var repeat = self._textures.length > i ? self._textures[i]\n        : self._textures[i] = self._image.pipe();\n    repeat.src(sx, sy, sw, sh);\n    repeat.dest(dx, dy, dw, dh);\n  }\n};\n","module.exports = function(img, owidth, oheight, stretch, inner, insert) {\n\n  var width = img.width;\n  var height = img.height;\n  var left = img.left;\n  var right = img.right;\n  var top = img.top;\n  var bottom = img.bottom;\n\n  left = typeof left === 'number' && left === left ? left : 0;\n  right = typeof right === 'number' && right === right ? right : 0;\n  top = typeof top === 'number' && top === top ? top : 0;\n  bottom = typeof bottom === 'number' && bottom === bottom ? bottom : 0;\n\n  width = width - left - right;\n  height = height - top - bottom;\n\n  if (!inner) {\n    owidth = Math.max(owidth - left - right, 0);\n    oheight = Math.max(oheight - top - bottom, 0);\n  }\n\n  var i = 0;\n\n  if (top > 0 && left > 0)\n    insert(i++, 0, 0, left, top, 0, 0, left, top);\n  if (bottom > 0 && left > 0)\n    insert(i++, 0, height + top, left, bottom, 0, oheight + top, left, bottom);\n  if (top > 0 && right > 0)\n    insert(i++, width + left, 0, right, top, owidth + left, 0, right, top);\n  if (bottom > 0 && right > 0)\n    insert(i++, width + left, height + top, right, bottom, owidth + left,\n        oheight + top, right, bottom);\n\n  if (stretch) {\n    if (top > 0)\n      insert(i++, left, 0, width, top, left, 0, owidth, top);\n    if (bottom > 0)\n      insert(i++, left, height + top, width, bottom, left, oheight + top,\n          owidth, bottom);\n    if (left > 0)\n      insert(i++, 0, top, left, height, 0, top, left, oheight);\n    if (right > 0)\n      insert(i++, width + left, top, right, height, owidth + left, top, right,\n          oheight);\n    // center\n    insert(i++, left, top, width, height, left, top, owidth, oheight);\n\n  } else { // tile\n    var l = left, r = owidth, w;\n    while (r > 0) {\n      w = Math.min(width, r), r -= width;\n      var t = top, b = oheight, h;\n      while (b > 0) {\n        h = Math.min(height, b), b -= height;\n        insert(i++, left, top, w, h, l, t, w, h);\n        if (r <= 0) {\n          if (left)\n            insert(i++, 0, top, left, h, 0, t, left, h);\n          if (right)\n            insert(i++, width + left, top, right, h, l + w, t, right, h);\n        }\n        t += h;\n      }\n      if (top)\n        insert(i++, left, 0, w, top, l, 0, w, top);\n      if (bottom)\n        insert(i++, left, height + top, w, bottom, l, t, w, bottom);\n      l += w;\n    }\n  }\n\n  return i;\n};","var Class = require('./core');\nrequire('./pin');\nrequire('./loop');\n\nvar create = require('./util/create');\nvar math = require('./util/math');\n\nClass.anim = function(frames, fps) {\n  var anim = new Anim();\n  anim.frames(frames).gotoFrame(0);\n  fps && anim.fps(fps);\n  return anim;\n};\n\nAnim._super = Class;\nAnim.prototype = create(Anim._super.prototype);\n\n// TODO: replace with atlas fps or texture time\nClass.Anim = {\n  FPS : 15\n};\n\nfunction Anim() {\n  Anim._super.call(this);\n  this.label('Anim');\n\n  this._textures = [];\n\n  this._fps = Class.Anim.FPS;\n  this._ft = 1000 / this._fps;\n\n  this._time = -1;\n  this._repeat = 0;\n\n  this._index = 0;\n  this._frames = [];\n\n  var lastTime = 0;\n  this.tick(function(t, now, last) {\n    if (this._time < 0 || this._frames.length <= 1) {\n      return;\n    }\n\n    // ignore old elapsed\n    var ignore = lastTime != last;\n    lastTime = now;\n    if (ignore) {\n      return true;\n    }\n\n    this._time += t;\n    if (this._time < this._ft) {\n      return true;\n    }\n    var n = this._time / this._ft | 0;\n    this._time -= n * this._ft;\n    this.moveFrame(n);\n    if (this._repeat > 0 && (this._repeat -= n) <= 0) {\n      this.stop();\n      this._callback && this._callback();\n      return false;\n    }\n    return true;\n  }, false);\n};\n\nAnim.prototype.fps = function(fps) {\n  if (typeof fps === 'undefined') {\n    return this._fps;\n  }\n  this._fps = fps > 0 ? fps : Class.Anim.FPS;\n  this._ft = 1000 / this._fps;\n  return this;\n};\n\n/**\n * @deprecated Use frames\n */\nAnim.prototype.setFrames = function(a, b, c) {\n  return this.frames(a, b, c);\n};\n\nAnim.prototype.frames = function(frames) {\n  this._index = 0;\n  this._frames = Class.texture(frames).array();\n  this.touch();\n  return this;\n};\n\nAnim.prototype.length = function() {\n  return this._frames ? this._frames.length : 0;\n};\n\nAnim.prototype.gotoFrame = function(frame, resize) {\n  this._index = math.rotate(frame, this._frames.length) | 0;\n  resize = resize || !this._textures[0];\n  this._textures[0] = this._frames[this._index];\n  if (resize) {\n    this.pin('width', this._textures[0].width);\n    this.pin('height', this._textures[0].height);\n  }\n  this.touch();\n  return this;\n};\n\nAnim.prototype.moveFrame = function(move) {\n  return this.gotoFrame(this._index + move);\n};\n\nAnim.prototype.repeat = function(repeat, callback) {\n  this._repeat = repeat * this._frames.length - 1;\n  this._callback = callback;\n  this.play();\n  return this;\n};\n\nAnim.prototype.play = function(frame) {\n  if (typeof frame !== 'undefined') {\n    this.gotoFrame(frame);\n    this._time = 0;\n  } else if (this._time < 0) {\n    this._time = 0;\n  }\n\n  this.touch();\n  return this;\n};\n\nAnim.prototype.stop = function(frame) {\n  this._time = -1;\n  if (typeof frame !== 'undefined') {\n    this.gotoFrame(frame);\n  }\n  return this;\n};\n","var Class = require('./core');\nrequire('./pin');\nrequire('./loop');\n\nvar create = require('./util/create');\nvar is = require('./util/is');\n\nClass.string = function(frames) {\n  return new Str().frames(frames);\n};\n\nStr._super = Class;\nStr.prototype = create(Str._super.prototype);\n\nfunction Str() {\n  Str._super.call(this);\n  this.label('String');\n  this._textures = [];\n};\n\n/**\n * @deprecated Use frames\n */\nStr.prototype.setFont = function(a, b, c) {\n  return this.frames(a, b, c);\n};\n\nStr.prototype.frames = function(frames) {\n  this._textures = [];\n  if (typeof frames == 'string') {\n    frames = Class.texture(frames);\n    this._item = function(value) {\n      return frames.one(value);\n    };\n  } else if (typeof frames === 'object') {\n    this._item = function(value) {\n      return frames[value];\n    };\n  } else if (typeof frames === 'function') {\n    this._item = frames;\n  }\n  return this;\n};\n\n/**\n * @deprecated Use value\n */\nStr.prototype.setValue = function(a, b, c) {\n  return this.value(a, b, c);\n};\n\nStr.prototype.value = function(value) {\n  if (typeof value === 'undefined') {\n    return this._value;\n  }\n  if (this._value === value) {\n    return this;\n  }\n  this._value = value;\n\n  if (value === null) {\n    value = '';\n  } else if (typeof value !== 'string' && !is.array(value)) {\n    value = value.toString();\n  }\n\n  this._spacing = this._spacing || 0;\n\n  var width = 0, height = 0;\n  for (var i = 0; i < value.length; i++) {\n    var image = this._textures[i] = this._item(value[i]);\n    width += i > 0 ? this._spacing : 0;\n    image.dest(width, 0);\n    width = width + image.width;\n    height = Math.max(height, image.height);\n  }\n  this.pin('width', width);\n  this.pin('height', height);\n  this._textures.length = value.length;\n  return this;\n};\n","var Class = require('./core');\nrequire('./pin');\nrequire('./loop');\n\nvar create = require('./util/create');\n\nClass.row = function(align) {\n  return Class.create().row(align).label('Row');\n};\n\nClass.prototype.row = function(align) {\n  this.sequence('row', align);\n  return this;\n};\n\nClass.column = function(align) {\n  return Class.create().column(align).label('Row');\n};\n\nClass.prototype.column = function(align) {\n  this.sequence('column', align);\n  return this;\n};\n\nClass.sequence = function(type, align) {\n  return Class.create().sequence(type, align).label('Sequence');\n};\n\nClass.prototype.sequence = function(type, align) {\n\n  this._padding = this._padding || 0;\n  this._spacing = this._spacing || 0;\n\n  this.untick(this._layoutTiker);\n  this.tick(this._layoutTiker = function() {\n    if (this._mo_seq == this._ts_touch) {\n      return;\n    }\n    this._mo_seq = this._ts_touch;\n\n    var alignChildren = (this._mo_seqAlign != this._ts_children);\n    this._mo_seqAlign = this._ts_children;\n\n    var width = 0, height = 0;\n\n    var child, next = this.first(true);\n    var first = true;\n    while (child = next) {\n      next = child.next(true);\n\n      child.matrix(true);\n      var w = child.pin('boxWidth');\n      var h = child.pin('boxHeight');\n\n      if (type == 'column') {\n        !first && (height += this._spacing);\n        child.pin('offsetY') != height && child.pin('offsetY', height);\n        width = Math.max(width, w);\n        height = height + h;\n        alignChildren && child.pin('alignX', align);\n\n      } else if (type == 'row') {\n        !first && (width += this._spacing);\n        child.pin('offsetX') != width && child.pin('offsetX', width);\n        width = width + w;\n        height = Math.max(height, h);\n        alignChildren && child.pin('alignY', align);\n      }\n      first = false;\n    }\n    width += 2 * this._padding;\n    height += 2 * this._padding;\n    this.pin('width') != width && this.pin('width', width);\n    this.pin('height') != height && this.pin('height', height);\n  });\n  return this;\n};\n\nClass.box = function() {\n  return Class.create().box().label('Box');\n};\n\nClass.prototype.box = function() {\n  this._padding = this._padding || 0;\n\n  this.untick(this._layoutTiker);\n  this.tick(this._layoutTiker = function() {\n    if (this._mo_box == this._ts_touch) {\n      return;\n    }\n    this._mo_box = this._ts_touch;\n\n    var width = 0, height = 0;\n    var child, next = this.first(true);\n    while (child = next) {\n      next = child.next(true);\n      child.matrix(true);\n      var w = child.pin('boxWidth');\n      var h = child.pin('boxHeight');\n      width = Math.max(width, w);\n      height = Math.max(height, h);\n    }\n    width += 2 * this._padding;\n    height += 2 * this._padding;\n    this.pin('width') != width && this.pin('width', width);\n    this.pin('height') != height && this.pin('height', height);\n  });\n  return this;\n};\n\nClass.layer = function() {\n  return Class.create().layer().label('Layer');\n};\n\nClass.prototype.layer = function() {\n\n  this.untick(this._layoutTiker);\n  this.tick(this._layoutTiker = function() {\n    var parent = this.parent();\n    if (parent) {\n      var width = parent.pin('width');\n      if (this.pin('width') != width) {\n        this.pin('width', width);\n      }\n      var height = parent.pin('height');\n      if (this.pin('height') != height) {\n        this.pin('height', height);\n      }\n    }\n  }, true);\n  return this;\n};\n\n// TODO: move padding to pin\nClass.prototype.padding = function(pad) {\n  this._padding = pad;\n  return this;\n};\n\nClass.prototype.spacing = function(space) {\n  this._spacing = space;\n  return this;\n};\n","var Easing = require('./easing');\nvar Class = require('../core');\nvar Pin = require('../pin');\n\nClass.prototype.tween = function(duration, delay, append) {\n  if (typeof duration !== 'number') {\n    append = duration, delay = 0, duration = 0;\n  } else if (typeof delay !== 'number') {\n    append = delay, delay = 0;\n  }\n\n  if (!this._tweens) {\n    this._tweens = [];\n    var ticktime = 0;\n    this.tick(function(elapsed, now, last) {\n      if (!this._tweens.length) {\n        return;\n      }\n\n      // ignore old elapsed\n      var ignore = ticktime != last;\n      ticktime = now;\n      if (ignore) {\n        return true;\n      }\n\n      var head = this._tweens[0];\n\n      var next = head.tick(this, elapsed, now, last);\n\n      if (next && head === this._tweens[0]) {\n        this._tweens.shift();\n      }\n\n      if (Array.isArray(next)) {\n        for (var i = 0; i < next.length; i++) {\n          try {\n            next[i].call(this);\n          } catch (e) {\n            console.log(e);\n          }\n        }\n      } else if (typeof next === 'object') {\n        this._tweens.unshift(next);\n      }\n\n      return true;\n    }, true);\n  }\n\n  this.touch();\n  if (!append) {\n    this._tweens.length = 0;\n  }\n  var tween = new Tween(this, duration, delay);\n  this._tweens.push(tween);\n  return tween;\n};\n\nfunction Tween(owner, duration, delay) {\n  this._end = {};\n  this._duration = duration || 400;\n  this._delay = delay || 0;\n\n  this._owner = owner;\n  this._time = 0;\n};\n\nTween.prototype.tick = function(node, elapsed, now, last) {\n  this._time += elapsed;\n\n  if (this._time < this._delay) {\n    return;\n  }\n\n  var time = this._time - this._delay;\n\n  if (!this._start) {\n    this._start = {};\n    for ( var key in this._end) {\n      this._start[key] = this._owner.pin(key);\n    }\n  }\n\n  var p, over;\n  if (time < this._duration) {\n    p = time / this._duration;\n    over = false;\n  } else {\n    p = 1;\n    over = true;\n  }\n\n  if (typeof this._easing == 'function') {\n    p = this._easing(p);\n  }\n\n  var q = 1 - p;\n\n  for ( var key in this._end) {\n    this._owner.pin(key, this._start[key] * q + this._end[key] * p);\n  }\n\n  if (over) {\n    var actions = [this._hide, this._remove, this._done];\n    actions = actions.filter(function( element ) {\n      return typeof element === 'function';\n    });\n    return this._next || actions;\n  }\n};\n\nTween.prototype.tween = function(duration, delay) {\n  return this._next = new Tween(this._owner, duration, delay);\n};\n\nTween.prototype.duration = function(duration) {\n  this._duration = duration;\n  return this;\n};\n\nTween.prototype.delay = function(delay) {\n  this._delay = delay;\n  return this;\n};\n\nTween.prototype.ease = function(easing) {\n  this._easing = Easing(easing);\n  return this;\n};\n\nTween.prototype.done = function(fn) {\n  this._done = fn;\n  return this;\n};\n\nTween.prototype.hide = function() {\n  this._hide = function() {\n    this.hide();\n  };\n  return this;\n};\n\nTween.prototype.remove = function() {\n  this._remove = function() {\n    this.remove();\n  };\n  return this;\n};\n\nTween.prototype.pin = function(a, b) {\n  if (typeof a === 'object') {\n    for ( var attr in a) {\n      pinning(this._owner, this._end, attr, a[attr]);\n    }\n  } else if (typeof b !== 'undefined') {\n    pinning(this._owner, this._end, a, b);\n  }\n  return this;\n};\n\nfunction pinning(node, map, key, value) {\n  if (typeof node.pin(key) === 'number') {\n    map[key] = value;\n  } else if (typeof node.pin(key + 'X') === 'number'\n      && typeof node.pin(key + 'Y') === 'number') {\n    map[key + 'X'] = value;\n    map[key + 'Y'] = value;\n  }\n}\n\nPin._add_shortcuts(Tween);\n\n/**\n * @deprecated Use .done(fn) instead.\n */\nTween.prototype.then = function(fn) {\n  this.done(fn);\n  return this;\n};\n\n/**\n * @deprecated NOOP\n */\nTween.prototype.clear = function(forward) {\n  return this;\n};\n\nmodule.exports = Tween;\n","function _identity(x) {\n  return x;\n};\nvar _cache = {};\nvar _modes = {};\nvar _easings = {};\n\nfunction Easing(token) {\n  if (typeof token === 'function') {\n    return token;\n  }\n  if (typeof token !== 'string') {\n    return _identity;\n  }\n  var fn = _cache[token];\n  if (fn) {\n    return fn;\n  }\n  var match = /^(\\w+)(-(in|out|in-out|out-in))?(\\((.*)\\))?$/i.exec(token);\n  if (!match || !match.length) {\n    return _identity;\n  }\n  var easing = _easings[match[1]];\n  var mode = _modes[match[3]];\n  var params = match[5];\n  if (easing && easing.fn) {\n    fn = easing.fn;\n  } else if (easing && easing.fc) {\n    fn = easing.fc.apply(easing.fc, params\n        && params.replace(/\\s+/, '').split(','));\n  } else {\n    fn = _identity;\n  }\n  if (mode) {\n    fn = mode.fn(fn);\n  }\n  // TODO: It can be a memory leak with different `params`.\n  _cache[token] = fn;\n  return fn;\n};\n\nEasing.add = function(data) {\n  // TODO: create a map of all { name-mode : data }\n  var names = (data.name || data.mode).split(/\\s+/);\n  for (var i = 0; i < names.length; i++) {\n    var name = names[i];\n    if (name) {\n      (data.name ? _easings : _modes)[name] = data;\n    }\n  }\n};\n\nEasing.add({\n  mode : 'in',\n  fn : function(f) {\n    return f;\n  }\n});\n\nEasing.add({\n  mode : 'out',\n  fn : function(f) {\n    return function(t) {\n      return 1 - f(1 - t);\n    };\n  }\n});\n\nEasing.add({\n  mode : 'in-out',\n  fn : function(f) {\n    return function(t) {\n      return (t < 0.5) ? (f(2 * t) / 2) : (1 - f(2 * (1 - t)) / 2);\n    };\n  }\n});\n\nEasing.add({\n  mode : 'out-in',\n  fn : function(f) {\n    return function(t) {\n      return (t < 0.5) ? (1 - f(2 * (1 - t)) / 2) : (f(2 * t) / 2);\n    };\n  }\n});\n\nEasing.add({\n  name : 'linear',\n  fn : function(t) {\n    return t;\n  }\n});\n\nEasing.add({\n  name : 'quad',\n  fn : function(t) {\n    return t * t;\n  }\n});\n\nEasing.add({\n  name : 'cubic',\n  fn : function(t) {\n    return t * t * t;\n  }\n});\n\nEasing.add({\n  name : 'quart',\n  fn : function(t) {\n    return t * t * t * t;\n  }\n});\n\nEasing.add({\n  name : 'quint',\n  fn : function(t) {\n    return t * t * t * t * t;\n  }\n});\n\nEasing.add({\n  name : 'sin sine',\n  fn : function(t) {\n    return 1 - Math.cos(t * Math.PI / 2);\n  }\n});\n\nEasing.add({\n  name : 'exp expo',\n  fn : function(t) {\n    return t == 0 ? 0 : Math.pow(2, 10 * (t - 1));\n  }\n});\n\nEasing.add({\n  name : 'circle circ',\n  fn : function(t) {\n    return 1 - Math.sqrt(1 - t * t);\n  }\n});\n\nEasing.add({\n  name : 'bounce',\n  fn : function(t) {\n    return t < 1 / 2.75 ? 7.5625 * t * t : t < 2 / 2.75 ? 7.5625\n        * (t -= 1.5 / 2.75) * t + .75 : t < 2.5 / 2.75 ? 7.5625\n        * (t -= 2.25 / 2.75) * t + .9375 : 7.5625 * (t -= 2.625 / 2.75) * t\n        + .984375;\n  }\n});\n\nEasing.add({\n  name : 'poly',\n  fc : function(e) {\n    return function(t) {\n      return Math.pow(t, e);\n    };\n  }\n});\n\nEasing.add({\n  name : 'elastic',\n  fc : function(a, p) {\n    p = p || 0.45;\n    a = a || 1;\n    var s = p / (2 * Math.PI) * Math.asin(1 / a);\n    return function(t) {\n      return 1 + a * Math.pow(2, -10 * t)\n          * Math.sin((t - s) * (2 * Math.PI) / p);\n    };\n  }\n});\n\nEasing.add({\n  name : 'back',\n  fc : function(s) {\n    s = typeof s !== 'undefined' ? s : 1.70158;\n    return function(t) {\n      return t * t * ((s + 1) * t - s);\n    };\n  }\n});\n\nmodule.exports = Easing;\n","var STAGE_DEBUG = typeof DEBUG === 'undefined' ? false : !!DEBUG;\n\nrequire('../core')._load(function(stage, elem) {\n  Mouse.subscribe(stage, elem);\n});\n\n// TODO: capture mouse\n\nMouse.CLICK = 'click';\nMouse.START = 'touchstart mousedown';\nMouse.MOVE = 'touchmove mousemove';\nMouse.END = 'touchend mouseup';\nMouse.CANCEL = 'touchcancel mousecancel';\n\nMouse.subscribe = function(stage, elem) {\n  if (stage.mouse) {\n    return;\n  }\n\n  stage.mouse = new Mouse(stage, elem);\n\n  // `click` events are synthesized from start/end events on same nodes\n  // `mousecancel` events are synthesized on blur or mouseup outside element\n\n  elem.addEventListener('touchstart', handleStart);\n  elem.addEventListener('touchend', handleEnd);\n  elem.addEventListener('touchmove', handleMove);\n  elem.addEventListener('touchcancel', handleCancel);\n\n  elem.addEventListener('mousedown', handleStart);\n  elem.addEventListener('mouseup', handleEnd);\n  elem.addEventListener('mousemove', handleMove);\n\n  document.addEventListener('mouseup', handleCancel);\n  window.addEventListener(\"blur\", handleCancel);\n\n  var clicklist = [], cancellist = [];\n\n  function handleStart(event) {\n    event.preventDefault();\n    stage.mouse.locate(event);\n    // STAGE_DEBUG && console.log('Mouse Start: ' + event.type + ' ' + mouse);\n    stage.mouse.publish(event.type, event);\n\n    stage.mouse.lookup('click', clicklist);\n    stage.mouse.lookup('mousecancel', cancellist);\n  }\n\n  function handleMove(event) {\n    event.preventDefault();\n    stage.mouse.locate(event);\n    stage.mouse.publish(event.type, event);\n  }\n\n  function handleEnd(event) {\n    event.preventDefault();\n    // up/end location is not available, last one is used instead\n    // STAGE_DEBUG && console.log('Mouse End: ' + event.type + ' ' + mouse);\n    stage.mouse.publish(event.type, event);\n\n    if (clicklist.length) {\n      // STAGE_DEBUG && console.log('Mouse Click: ' + clicklist.length);\n      stage.mouse.publish('click', event, clicklist);\n    }\n    cancellist.length = 0;\n  }\n\n  function handleCancel(event) {\n    if (cancellist.length) {\n      // STAGE_DEBUG && console.log('Mouse Cancel: ' + event.type);\n      stage.mouse.publish('mousecancel', event, cancellist);\n    }\n    clicklist.length = 0;\n  }\n};\n\nfunction Mouse(stage, elem) {\n  if (!(this instanceof Mouse)) {\n    // old-style mouse subscription\n    return;\n  }\n\n  var ratio = stage.viewport().ratio || 1;\n\n  stage.on('viewport', function(size) {\n    ratio = size.ratio || ratio;\n  });\n\n  this.x = 0;\n  this.y = 0;\n  this.toString = function() {\n    return (this.x | 0) + 'x' + (this.y | 0);\n  };\n  this.locate = function(event) {\n    locateElevent(elem, event, this);\n    this.x *= ratio;\n    this.y *= ratio;\n  };\n  this.lookup = function(type, collect) {\n    this.type = type;\n    this.root = stage;\n    this.event = null;\n    collect.length = 0;\n    this.collect = collect;\n\n    this.root.visit(this.visitor, this);\n  };\n  this.publish = function(type, event, targets) {\n    this.type = type;\n    this.root = stage;\n    this.event = event;\n    this.collect = false;\n    this.timeStamp = Date.now();\n\n    if (type !== 'mousemove' && type !== 'touchmove') {\n      STAGE_DEBUG && console.log(this.type + ' ' + this);\n    }\n\n    if (targets) {\n      while (targets.length)\n        if (this.visitor.end(targets.shift(), this))\n          break;\n      targets.length = 0;\n    } else {\n      this.root.visit(this.visitor, this);\n    }\n  };\n  this.visitor = {\n    reverse : true,\n    visible : true,\n    start : function(node, mouse) {\n      return !node._flag(mouse.type);\n    },\n    end : function(node, mouse) {\n      // mouse: event/collect, type, root\n      rel.raw = mouse.event;\n      rel.type = mouse.type;\n      rel.timeStamp = mouse.timeStamp;\n      rel.abs.x = mouse.x;\n      rel.abs.y = mouse.y;\n\n      var listeners = node.listeners(mouse.type);\n      if (!listeners) {\n        return;\n      }\n      node.matrix().inverse().map(mouse, rel);\n      if (!(node === mouse.root || node.attr('spy') || node.hitTest(rel))) {\n        return;\n      }\n      if (mouse.collect) {\n        mouse.collect.push(node);\n      }\n      if (mouse.event) {\n        var cancel = false;\n        for (var l = 0; l < listeners.length; l++) {\n          cancel = listeners[l].call(node, rel) ? true : cancel;\n        }\n        return cancel;\n      }\n    }\n  };\n};\n\n// TODO: define per mouse object with get-only x and y\nvar rel = {}, abs = {};\n\ndefineValue(rel, 'clone', function(obj) {\n  obj = obj || {}, obj.x = this.x, obj.y = this.y;\n  return obj;\n});\ndefineValue(rel, 'toString', function() {\n  return (this.x | 0) + 'x' + (this.y | 0) + ' (' + this.abs + ')';\n});\ndefineValue(rel, 'abs', abs);\ndefineValue(abs, 'clone', function(obj) {\n  obj = obj || {}, obj.x = this.x, obj.y = this.y;\n  return obj;\n});\ndefineValue(abs, 'toString', function() {\n  return (this.x | 0) + 'x' + (this.y | 0);\n});\n\nfunction defineValue(obj, name, value) {\n  Object.defineProperty(obj, name, {\n    value : value\n  });\n}\n\nfunction locateElevent(el, ev, loc) {\n  // pageX/Y if available?\n  if (ev.touches && ev.touches.length) {\n    loc.x = ev.touches[0].clientX;\n    loc.y = ev.touches[0].clientY;\n  } else {\n    loc.x = ev.clientX;\n    loc.y = ev.clientY;\n  }\n  var rect = el.getBoundingClientRect();\n  loc.x -= rect.left;\n  loc.y -= rect.top;\n  loc.x -= el.clientLeft | 0;\n  loc.y -= el.clientTop | 0;\n  return loc;\n};\n\nmodule.exports = Mouse;\n","module.exports = require('../lib/');\n\nmodule.exports.internal = {};\n\nrequire('../lib/canvas');\nmodule.exports.internal.Image = require('../lib/image');\nrequire('../lib/anim');\nrequire('../lib/str');\nrequire('../lib/layout');\nrequire('../lib/addon/tween');\nmodule.exports.Mouse = require('../lib/addon/mouse');\nmodule.exports.Math = require('../lib/util/math');\nmodule.exports._extend = require('../lib/util/extend');\nmodule.exports._create = require('../lib/util/create');\n\nrequire('../lib/loader/web');","/**\n * Default loader for web.\n */\n\nvar STAGE_DEBUG = typeof DEBUG === 'undefined' ? false : !!DEBUG;\n\nvar Class = require('../core');\n\nClass._supported = (function() {\n  var elem = document.createElement('canvas');\n  return (elem.getContext && elem.getContext('2d')) ? true : false;\n})();\n\nwindow.addEventListener('load', function() {\n  STAGE_DEBUG && console.log('On load.');\n  if (Class._supported) {\n    Class.start();\n  }\n  // TODO if not supported\n}, false);\n\nClass.config({\n  'app-loader' : AppLoader,\n  'image-loader' : ImageLoader\n});\n\nfunction AppLoader(app, configs) {\n  configs = configs || {};\n  var canvas = configs.canvas, context = null, full = false;\n  var width = 0, height = 0, ratio = 1;\n\n  if (typeof canvas === 'string') {\n    canvas = document.getElementById(canvas);\n  }\n\n  if (!canvas) {\n    canvas = document.getElementById('cutjs')\n        || document.getElementById('stage');\n  }\n\n  if (!canvas) {\n    full = true;\n    STAGE_DEBUG && console.log('Creating Canvas...');\n    canvas = document.createElement('canvas');\n    canvas.style.position = 'absolute';\n    canvas.style.top = '0';\n    canvas.style.left = '0';\n\n    var body = document.body;\n    body.insertBefore(canvas, body.firstChild);\n  }\n\n  context = canvas.getContext('2d');\n\n  var devicePixelRatio = window.devicePixelRatio || 1;\n  var backingStoreRatio = context.webkitBackingStorePixelRatio\n      || context.mozBackingStorePixelRatio || context.msBackingStorePixelRatio\n      || context.oBackingStorePixelRatio || context.backingStorePixelRatio || 1;\n  ratio = devicePixelRatio / backingStoreRatio;\n\n  var requestAnimationFrame = window.requestAnimationFrame\n      || window.msRequestAnimationFrame || window.mozRequestAnimationFrame\n      || window.webkitRequestAnimationFrame || window.oRequestAnimationFrame\n      || function(callback) {\n        return window.setTimeout(callback, 1000 / 60);\n      };\n\n  STAGE_DEBUG && console.log('Creating stage...');\n  var root = Class.root(requestAnimationFrame, render);\n\n  function render() {\n    if (width > 0 && height > 0) {\n      context.setTransform(1, 0, 0, 1, 0, 0);\n      context.clearRect(0, 0, width, height);\n      root.render(context);\n    }\n  }\n\n  root.background = function(color) {\n    canvas.style.backgroundColor = color;\n    return this;\n  };\n\n  app(root, canvas);\n\n  // resize();\n  // window.addEventListener('resize', resize, false);\n  // window.addEventListener('orientationchange', resize, false);\n\n  var lastWidth = -1;\n  var lastHeight = -1;\n  (function resizeLoop() {\n    var width, height;\n    if (full) {\n      // screen.availWidth/Height?\n      width = (window.innerWidth > 0 ? window.innerWidth : screen.width);\n      height = (window.innerHeight > 0 ? window.innerHeight : screen.height);\n    } else {\n      width = canvas.clientWidth;\n      height = canvas.clientHeight;\n    }\n    if (lastWidth !== width || lastHeight !== height) {\n      lastWidth = width;\n      lastHeight = height;\n      resize();\n    }\n    requestAnimationFrame(resizeLoop);\n  })();\n\n  function resize() {\n\n    if (full) {\n      // screen.availWidth/Height?\n      width = (window.innerWidth > 0 ? window.innerWidth : screen.width);\n      height = (window.innerHeight > 0 ? window.innerHeight : screen.height);\n\n      canvas.style.width = width + 'px';\n      canvas.style.height = height + 'px';\n\n    } else {\n      width = canvas.clientWidth;\n      height = canvas.clientHeight;\n    }\n\n    width *= ratio;\n    height *= ratio;\n\n    if (canvas.width === width && canvas.height === height) {\n      return;\n    }\n\n    canvas.width = width;\n    canvas.height = height;\n\n    STAGE_DEBUG && console.log('Resize: ' + width + ' x ' + height + ' / ' + ratio);\n\n    root.viewport(width, height, ratio);\n\n    render();\n  }\n}\n\nfunction ImageLoader(src, success, error) {\n  STAGE_DEBUG && console.log('Loading image: ' + src);\n  var image = new Image();\n  image.onload = function() {\n    success(image);\n  };\n  image.onerror = error;\n  image.src = src;\n}\n"],"sourceRoot":""}